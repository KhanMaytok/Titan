/*!
 * starcitizen-webgl-map v0.9.0 by Lianna Eeftinck
 * Copyright 2015 Lianna Eeftinck
 * https://github.com/Leeft/Star-Citizen-WebGL-Map
 * Licensed under http://opensource.org/licenses/MIT
 */
if (typeof jQuery === "undefined") { throw new Error("starcitizen-webgl-map requires jQuery"); }
if (typeof THREE === "undefined") { throw new Error("starcitizen-webgl-map requires THREE.js"); }
function _build_selected_system_object(){var a=(new THREE.JSONLoader).parse({metadata:{formatVersion:3.1,sourceFile:"selected_system.obj",generatedBy:"OBJConverter",vertices:248,faces:248,normals:960,colors:0,uvs:0,materials:1},scale:1,vertices:[-.5,.5,.5,-.52,.2,.5,-.52,.2,.44,-.52,.44,.44,-.52,.5,.5,-.5,.52,.5,-.5,.5,.52,-.52,.44,.2,-.52,.5,.2,-.5,.52,.2,-.44,.52,.2,-.44,.52,.44,-.44,.44,.52,-.5,.2,.52,-.44,.2,.52,-.2,.52,.44,-.2,.52,.5,-.2,.5,.52,-.2,.44,.52,-.5,.44,.2,-.5,.5,.2,-.44,.5,.2,-.2,.44,.5,-.2,.5,.44,-.2,.5,.5,-.5,.44,.44,-.44,.44,.5,-.44,.5,.44,-.5,.2,.5,-.5,.2,.44,-.44,.2,.5,.5,.5,.5,.52,.2,.5,.52,.2,.44,.52,.44,.44,.52,.5,.5,.5,.52,.5,.5,.5,.52,.52,.44,.2,.52,.5,.2,.5,.52,.2,.44,.52,.2,.44,.52,.44,.44,.44,.52,.5,.2,.52,.44,.2,.52,.2,.52,.44,.2,.52,.5,.2,.5,.52,.2,.44,.52,.5,.44,.2,.5,.5,.2,.44,.5,.2,.2,.44,.5,.2,.5,.44,.2,.5,.5,.5,.44,.44,.44,.44,.5,.44,.5,.44,.5,.2,.5,.5,.2,.44,.44,.2,.5,-.5,-.5,.5,-.52,-.2,.5,-.52,-.2,.44,-.52,-.44,.44,-.52,-.5,.5,-.5,-.52,.5,-.5,-.5,.52,-.52,-.44,.2,-.52,-.5,.2,-.5,-.52,.2,-.44,-.52,.2,-.44,-.52,.44,-.44,-.44,.52,-.5,-.2,.52,-.44,-.2,.52,-.2,-.52,.44,-.2,-.52,.5,-.2,-.5,.52,-.2,-.44,.52,-.5,-.44,.2,-.5,-.5,.2,-.44,-.5,.2,-.2,-.44,.5,-.2,-.5,.44,-.2,-.5,.5,-.5,-.44,.44,-.44,-.44,.5,-.44,-.5,.44,-.5,-.2,.5,-.5,-.2,.44,-.44,-.2,.5,.5,-.5,.5,.52,-.2,.5,.52,-.2,.44,.52,-.44,.44,.52,-.5,.5,.5,-.52,.5,.5,-.5,.52,.52,-.44,.2,.52,-.5,.2,.5,-.52,.2,.44,-.52,.2,.44,-.52,.44,.44,-.44,.52,.5,-.2,.52,.44,-.2,.52,.2,-.52,.44,.2,-.52,.5,.2,-.5,.52,.2,-.44,.52,.5,-.44,.2,.5,-.5,.2,.44,-.5,.2,.2,-.44,.5,.2,-.5,.44,.2,-.5,.5,.5,-.44,.44,.44,-.44,.5,.44,-.5,.44,.5,-.2,.5,.5,-.2,.44,.44,-.2,.5,-.5,.5,-.5,-.52,.2,-.5,-.52,.2,-.44,-.52,.44,-.44,-.52,.5,-.5,-.5,.52,-.5,-.5,.5,-.52,-.52,.44,-.2,-.52,.5,-.2,-.5,.52,-.2,-.44,.52,-.2,-.44,.52,-.44,-.44,.44,-.52,-.5,.2,-.52,-.44,.2,-.52,-.2,.52,-.44,-.2,.52,-.5,-.2,.5,-.52,-.2,.44,-.52,-.5,.44,-.2,-.5,.5,-.2,-.44,.5,-.2,-.2,.44,-.5,-.2,.5,-.44,-.2,.5,-.5,-.5,.44,-.44,-.44,.44,-.5,-.44,.5,-.44,-.5,.2,-.5,-.5,.2,-.44,-.44,.2,-.5,.5,.5,-.5,.52,.2,-.5,.52,.2,-.44,.52,.44,-.44,.52,.5,-.5,.5,.52,-.5,.5,.5,-.52,.52,.44,-.2,.52,.5,-.2,.5,.52,-.2,.44,.52,-.2,.44,.52,-.44,.44,.44,-.52,.5,.2,-.52,.44,.2,-.52,.2,.52,-.44,.2,.52,-.5,.2,.5,-.52,.2,.44,-.52,.5,.44,-.2,.5,.5,-.2,.44,.5,-.2,.2,.44,-.5,.2,.5,-.44,.2,.5,-.5,.5,.44,-.44,.44,.44,-.5,.44,.5,-.44,.5,.2,-.5,.5,.2,-.44,.44,.2,-.5,-.5,-.5,-.5,-.52,-.2,-.5,-.52,-.2,-.44,-.52,-.44,-.44,-.52,-.5,-.5,-.5,-.52,-.5,-.5,-.5,-.52,-.52,-.44,-.2,-.52,-.5,-.2,-.5,-.52,-.2,-.44,-.52,-.2,-.44,-.52,-.44,-.44,-.44,-.52,-.5,-.2,-.52,-.44,-.2,-.52,-.2,-.52,-.44,-.2,-.52,-.5,-.2,-.5,-.52,-.2,-.44,-.52,-.5,-.44,-.2,-.5,-.5,-.2,-.44,-.5,-.2,-.2,-.44,-.5,-.2,-.5,-.44,-.2,-.5,-.5,-.5,-.44,-.44,-.44,-.44,-.5,-.44,-.5,-.44,-.5,-.2,-.5,-.5,-.2,-.44,-.44,-.2,-.5,.5,-.5,-.5,.52,-.2,-.5,.52,-.2,-.44,.52,-.44,-.44,.52,-.5,-.5,.5,-.52,-.5,.5,-.5,-.52,.52,-.44,-.2,.52,-.5,-.2,.5,-.52,-.2,.44,-.52,-.2,.44,-.52,-.44,.44,-.44,-.52,.5,-.2,-.52,.44,-.2,-.52,.2,-.52,-.44,.2,-.52,-.5,.2,-.5,-.52,.2,-.44,-.52,.5,-.44,-.2,.5,-.5,-.2,.44,-.5,-.2,.2,-.44,-.5,.2,-.5,-.44,.2,-.5,-.5,.5,-.44,-.44,.44,-.44,-.5,.44,-.5,-.44,.5,-.2,-.5,.5,-.2,-.44,.44,-.2,-.5],morphTargets:[],morphColors:[],normals:[-.25969,.62694,-.73451,-.62694,.25969,-.73451,-.91018,.29289,.29289,-.29289,.91018,.29289,-.62694,-.73451,.25969,-.25969,-.73451,.62694,-.29289,.29289,.91018,-.91018,.29289,.29289,.73451,.25969,.62694,.73451,.62694,.25969,-.29289,.91018,.29289,-.29289,.29289,.91018,-.29289,.29289,.91018,-.29289,.91018,.29289,-.91018,.29289,.29289,.57735,-.57735,-.57735,.57735,-.57735,.57735,.40825,-.40825,.8165,.40825,-.40825,-.8165,.57735,-.57735,.57735,.57735,-.57735,-.57735,.40825,-.40825,-.8165,.40825,-.40825,.8165,.57735,.57735,-.57735,.57735,-.57735,-.57735,.40825,-.8165,-.40825,.40825,.8165,-.40825,.57735,-.57735,-.57735,.57735,.57735,-.57735,.40825,.8165,-.40825,.40825,-.8165,-.40825,-.57735,-.57735,-.57735,.57735,-.57735,-.57735,.8165,-.40825,-.40825,-.8165,-.40825,-.40825,.57735,-.57735,-.57735,-.57735,-.57735,-.57735,-.8165,-.40825,-.40825,.8165,-.40825,-.40825,.57735,-.57735,.57735,.40825,-.40825,.8165,-.29289,.29289,.91018,-.25969,-.73451,.62694,.40825,-.40825,.8165,.57735,-.57735,.57735,.73451,.25969,.62694,-.29289,.29289,.91018,-.91018,.29289,.29289,-.8165,-.40825,-.40825,-.57735,-.57735,-.57735,-.62694,-.73451,.25969,-.57735,-.57735,-.57735,-.8165,-.40825,-.40825,-.91018,.29289,.29289,-.62694,.25969,-.73451,.40825,.8165,-.40825,.57735,.57735,-.57735,-.25969,.62694,-.73451,-.29289,.91018,.29289,.57735,.57735,-.57735,.40825,.8165,-.40825,-.29289,.91018,.29289,.73451,.62694,.25969,.57735,-.57735,-.57735,.8165,-.40825,-.40825,.57735,-.57735,-.57735,.30151,-.90453,-.30151,.8165,-.40825,-.40825,.57735,-.57735,-.57735,.30151,-.30151,-.90453,.57735,-.57735,-.57735,.57735,-.57735,-.57735,.40825,-.8165,-.40825,.57735,-.57735,-.57735,.30151,-.30151,-.90453,.57735,-.57735,-.57735,.40825,-.8165,-.40825,.57735,-.57735,-.57735,.90453,-.30151,-.30151,.40825,-.40825,-.8165,.57735,-.57735,-.57735,.30151,-.90453,-.30151,.57735,-.57735,-.57735,.57735,-.57735,-.57735,.40825,-.40825,-.8165,.57735,-.57735,-.57735,.90453,-.30151,-.30151,.57735,-.57735,-.57735,.90453,-.30151,-.30151,.73451,.25969,.62694,.57735,-.57735,.57735,.90453,-.30151,-.30151,.73451,.62694,.25969,.73451,.25969,.62694,.57735,-.57735,-.57735,.57735,.57735,-.57735,.73451,.62694,.25969,.90453,-.30151,-.30151,-.62694,.25969,-.73451,-.25969,.62694,-.73451,.30151,-.30151,-.90453,-.62694,.25969,-.73451,.30151,-.30151,-.90453,.57735,-.57735,-.57735,-.57735,-.57735,-.57735,-.62694,-.73451,.25969,-.57735,-.57735,-.57735,.57735,-.57735,-.57735,.30151,-.90453,-.30151,-.62694,-.73451,.25969,.30151,-.90453,-.30151,-.25969,-.73451,.62694,.30151,-.30151,-.90453,-.25969,.62694,-.73451,.57735,.57735,-.57735,.57735,-.57735,-.57735,-.25969,-.73451,.62694,.30151,-.90453,-.30151,.57735,-.57735,-.57735,.57735,-.57735,.57735,.91018,.29289,.29289,.62694,.25969,-.73451,.25969,.62694,-.73451,.29289,.91018,.29289,.29289,.29289,.91018,.25969,-.73451,.62694,.62694,-.73451,.25969,.91018,.29289,.29289,.29289,.91018,.29289,-.73451,.62694,.25969,-.73451,.25969,.62694,.29289,.29289,.91018,.29289,.91018,.29289,.29289,.29289,.91018,.91018,.29289,.29289,-.40825,-.40825,.8165,-.57735,-.57735,.57735,-.57735,-.57735,-.57735,-.40825,-.40825,-.8165,-.40825,-.40825,-.8165,-.57735,-.57735,-.57735,-.57735,-.57735,.57735,-.40825,-.40825,.8165,-.40825,-.8165,-.40825,-.57735,-.57735,-.57735,-.57735,.57735,-.57735,-.40825,.8165,-.40825,-.40825,.8165,-.40825,-.57735,.57735,-.57735,-.57735,-.57735,-.57735,-.40825,-.8165,-.40825,-.8165,-.40825,-.40825,-.57735,-.57735,-.57735,.57735,-.57735,-.57735,.8165,-.40825,-.40825,.8165,-.40825,-.40825,.57735,-.57735,-.57735,-.57735,-.57735,-.57735,-.8165,-.40825,-.40825,.29289,.29289,.91018,-.40825,-.40825,.8165,-.57735,-.57735,.57735,.25969,-.73451,.62694,-.73451,.25969,.62694,-.57735,-.57735,.57735,-.40825,-.40825,.8165,.29289,.29289,.91018,.57735,-.57735,-.57735,.8165,-.40825,-.40825,.91018,.29289,.29289,.62694,-.73451,.25969,.91018,.29289,.29289,.8165,-.40825,-.40825,.57735,-.57735,-.57735,.62694,.25969,-.73451,.25969,.62694,-.73451,-.57735,.57735,-.57735,-.40825,.8165,-.40825,.29289,.91018,.29289,.29289,.91018,.29289,-.40825,.8165,-.40825,-.57735,.57735,-.57735,-.73451,.62694,.25969,-.57735,-.57735,-.57735,-.8165,-.40825,-.40825,-.57735,-.57735,-.57735,-.30151,-.90453,-.30151,-.30151,-.30151,-.90453,-.57735,-.57735,-.57735,-.8165,-.40825,-.40825,-.57735,-.57735,-.57735,-.57735,-.57735,-.57735,-.40825,-.8165,-.40825,-.57735,-.57735,-.57735,-.30151,-.30151,-.90453,-.57735,-.57735,-.57735,-.40825,-.8165,-.40825,-.57735,-.57735,-.57735,-.90453,-.30151,-.30151,-.30151,-.90453,-.30151,-.57735,-.57735,-.57735,-.40825,-.40825,-.8165,-.57735,-.57735,-.57735,-.57735,-.57735,-.57735,-.40825,-.40825,-.8165,-.57735,-.57735,-.57735,-.90453,-.30151,-.30151,-.73451,.25969,.62694,-.90453,-.30151,-.30151,-.57735,-.57735,-.57735,-.57735,-.57735,.57735,-.73451,.62694,.25969,-.90453,-.30151,-.30151,-.73451,.25969,.62694,-.73451,.62694,.25969,-.57735,.57735,-.57735,-.57735,-.57735,-.57735,-.90453,-.30151,-.30151,.25969,.62694,-.73451,.62694,.25969,-.73451,-.30151,-.30151,-.90453,-.57735,-.57735,-.57735,-.30151,-.30151,-.90453,.62694,.25969,-.73451,.57735,-.57735,-.57735,-.57735,-.57735,-.57735,.57735,-.57735,-.57735,.62694,-.73451,.25969,-.30151,-.90453,-.30151,-.30151,-.90453,-.30151,.62694,-.73451,.25969,.25969,-.73451,.62694,-.57735,.57735,-.57735,.25969,.62694,-.73451,-.30151,-.30151,-.90453,-.57735,-.57735,-.57735,-.57735,-.57735,-.57735,-.30151,-.90453,-.30151,.25969,-.73451,.62694,-.57735,-.57735,.57735,-.91018,-.29289,.29289,-.62694,-.25969,-.73451,-.25969,-.62694,-.73451,-.29289,-.91018,.29289,-.29289,-.29289,.91018,-.25969,.73451,.62694,-.62694,.73451,.25969,-.91018,-.29289,.29289,-.29289,-.91018,.29289,.73451,-.62694,.25969,.73451,-.25969,.62694,-.29289,-.29289,.91018,-.29289,-.91018,.29289,-.29289,-.29289,.91018,-.91018,-.29289,.29289,.40825,.40825,.8165,.57735,.57735,.57735,.57735,.57735,-.57735,.40825,.40825,-.8165,.40825,.40825,-.8165,.57735,.57735,-.57735,.57735,.57735,.57735,.40825,.40825,.8165,.40825,.8165,-.40825,.57735,.57735,-.57735,.57735,-.57735,-.57735,.40825,-.8165,-.40825,.40825,-.8165,-.40825,.57735,-.57735,-.57735,.57735,.57735,-.57735,.40825,.8165,-.40825,.8165,.40825,-.40825,.57735,.57735,-.57735,-.57735,.57735,-.57735,-.8165,.40825,-.40825,-.8165,.40825,-.40825,-.57735,.57735,-.57735,.57735,.57735,-.57735,.8165,.40825,-.40825,-.29289,-.29289,.91018,.40825,.40825,.8165,.57735,.57735,.57735,-.25969,.73451,.62694,.73451,-.25969,.62694,.57735,.57735,.57735,.40825,.40825,.8165,-.29289,-.29289,.91018,-.57735,.57735,-.57735,-.8165,.40825,-.40825,-.91018,-.29289,.29289,-.62694,.73451,.25969,-.91018,-.29289,.29289,-.8165,.40825,-.40825,-.57735,.57735,-.57735,-.62694,-.25969,-.73451,-.25969,-.62694,-.73451,.57735,-.57735,-.57735,.40825,-.8165,-.40825,-.29289,-.91018,.29289,-.29289,-.91018,.29289,.40825,-.8165,-.40825,.57735,-.57735,-.57735,.73451,-.62694,.25969,.57735,.57735,-.57735,.8165,.40825,-.40825,.57735,.57735,-.57735,.30151,.90453,-.30151,.30151,.30151,-.90453,.57735,.57735,-.57735,.8165,.40825,-.40825,.57735,.57735,-.57735,.57735,.57735,-.57735,.40825,.8165,-.40825,.57735,.57735,-.57735,.30151,.30151,-.90453,.57735,.57735,-.57735,.40825,.8165,-.40825,.57735,.57735,-.57735,.90453,.30151,-.30151,.30151,.90453,-.30151,.57735,.57735,-.57735,.40825,.40825,-.8165,.57735,.57735,-.57735,.57735,.57735,-.57735,.40825,.40825,-.8165,.57735,.57735,-.57735,.90453,.30151,-.30151,.73451,-.25969,.62694,.90453,.30151,-.30151,.57735,.57735,-.57735,.57735,.57735,.57735,.73451,-.62694,.25969,.90453,.30151,-.30151,.73451,-.25969,.62694,.73451,-.62694,.25969,.57735,-.57735,-.57735,.57735,.57735,-.57735,.90453,.30151,-.30151,-.25969,-.62694,-.73451,-.62694,-.25969,-.73451,.30151,.30151,-.90453,.57735,.57735,-.57735,.30151,.30151,-.90453,-.62694,-.25969,-.73451,-.57735,.57735,-.57735,.57735,.57735,-.57735,-.57735,.57735,-.57735,-.62694,.73451,.25969,.30151,.90453,-.30151,.30151,.90453,-.30151,-.62694,.73451,.25969,-.25969,.73451,.62694,.57735,-.57735,-.57735,-.25969,-.62694,-.73451,.30151,.30151,-.90453,.57735,.57735,-.57735,.57735,.57735,-.57735,.30151,.90453,-.30151,-.25969,.73451,.62694,.57735,.57735,.57735,.25969,-.62694,-.73451,.62694,-.25969,-.73451,.91018,-.29289,.29289,.29289,-.91018,.29289,.62694,.73451,.25969,.25969,.73451,.62694,.29289,-.29289,.91018,.91018,-.29289,.29289,-.73451,-.25969,.62694,-.73451,-.62694,.25969,.29289,-.91018,.29289,.29289,-.29289,.91018,.29289,-.29289,.91018,.29289,-.91018,.29289,.91018,-.29289,.29289,-.57735,.57735,-.57735,-.57735,.57735,.57735,-.40825,.40825,.8165,-.40825,.40825,-.8165,-.57735,.57735,.57735,-.57735,.57735,-.57735,-.40825,.40825,-.8165,-.40825,.40825,.8165,-.57735,-.57735,-.57735,-.57735,.57735,-.57735,-.40825,.8165,-.40825,-.40825,-.8165,-.40825,-.57735,.57735,-.57735,-.57735,-.57735,-.57735,-.40825,-.8165,-.40825,-.40825,.8165,-.40825,.57735,.57735,-.57735,-.57735,.57735,-.57735,-.8165,.40825,-.40825,.8165,.40825,-.40825,-.57735,.57735,-.57735,.57735,.57735,-.57735,.8165,.40825,-.40825,-.8165,.40825,-.40825,-.57735,.57735,.57735,-.40825,.40825,.8165,.29289,-.29289,.91018,.25969,.73451,.62694,-.40825,.40825,.8165,-.57735,.57735,.57735,-.73451,-.25969,.62694,.29289,-.29289,.91018,.91018,-.29289,.29289,.8165,.40825,-.40825,.57735,.57735,-.57735,.62694,.73451,.25969,.57735,.57735,-.57735,.8165,.40825,-.40825,.91018,-.29289,.29289,.62694,-.25969,-.73451,-.40825,-.8165,-.40825,-.57735,-.57735,-.57735,.25969,-.62694,-.73451,.29289,-.91018,.29289,-.57735,-.57735,-.57735,-.40825,-.8165,-.40825,.29289,-.91018,.29289,-.73451,-.62694,.25969,-.57735,.57735,-.57735,-.8165,.40825,-.40825,-.57735,.57735,-.57735,-.30151,.90453,-.30151,-.8165,.40825,-.40825,-.57735,.57735,-.57735,-.30151,.30151,-.90453,-.57735,.57735,-.57735,-.57735,.57735,-.57735,-.40825,.8165,-.40825,-.57735,.57735,-.57735,-.30151,.30151,-.90453,-.57735,.57735,-.57735,-.40825,.8165,-.40825,-.57735,.57735,-.57735,-.90453,.30151,-.30151,-.40825,.40825,-.8165,-.57735,.57735,-.57735,-.30151,.90453,-.30151,-.57735,.57735,-.57735,-.57735,.57735,-.57735,-.40825,.40825,-.8165,-.57735,.57735,-.57735,-.90453,.30151,-.30151,-.57735,.57735,-.57735,-.90453,.30151,-.30151,-.73451,-.25969,.62694,-.57735,.57735,.57735,-.90453,.30151,-.30151,-.73451,-.62694,.25969,-.73451,-.25969,.62694,-.57735,.57735,-.57735,-.57735,-.57735,-.57735,-.73451,-.62694,.25969,-.90453,.30151,-.30151,.62694,-.25969,-.73451,.25969,-.62694,-.73451,-.30151,.30151,-.90453,.62694,-.25969,-.73451,-.30151,.30151,-.90453,-.57735,.57735,-.57735,.57735,.57735,-.57735,.62694,.73451,.25969,.57735,.57735,-.57735,-.57735,.57735,-.57735,-.30151,.90453,-.30151,.62694,.73451,.25969,-.30151,.90453,-.30151,.25969,.73451,.62694,-.30151,.30151,-.90453,.25969,-.62694,-.73451,-.57735,-.57735,-.57735,-.57735,.57735,-.57735,.25969,.73451,.62694,-.30151,.90453,-.30151,-.57735,.57735,-.57735,-.57735,.57735,.57735,-.91018,.29289,-.29289,-.62694,.25969,.73451,-.25969,.62694,.73451,-.29289,.91018,-.29289,-.29289,.29289,-.91018,-.25969,-.73451,-.62694,-.62694,-.73451,-.25969,-.91018,.29289,-.29289,-.29289,.91018,-.29289,.73451,.62694,-.25969,.73451,.25969,-.62694,-.29289,.29289,-.91018,-.29289,.91018,-.29289,-.29289,.29289,-.91018,-.91018,.29289,-.29289,.40825,-.40825,-.8165,.57735,-.57735,-.57735,.57735,-.57735,.57735,.40825,-.40825,.8165,.40825,-.40825,.8165,.57735,-.57735,.57735,.57735,-.57735,-.57735,.40825,-.40825,-.8165,.40825,-.8165,.40825,.57735,-.57735,.57735,.57735,.57735,.57735,.40825,.8165,.40825,.40825,.8165,.40825,.57735,.57735,.57735,.57735,-.57735,.57735,.40825,-.8165,.40825,.8165,-.40825,.40825,.57735,-.57735,.57735,-.57735,-.57735,.57735,-.8165,-.40825,.40825,-.8165,-.40825,.40825,-.57735,-.57735,.57735,.57735,-.57735,.57735,.8165,-.40825,.40825,-.29289,.29289,-.91018,.40825,-.40825,-.8165,.57735,-.57735,-.57735,-.25969,-.73451,-.62694,.73451,.25969,-.62694,.57735,-.57735,-.57735,.40825,-.40825,-.8165,-.29289,.29289,-.91018,-.57735,-.57735,.57735,-.8165,-.40825,.40825,-.91018,.29289,-.29289,-.62694,-.73451,-.25969,-.91018,.29289,-.29289,-.8165,-.40825,.40825,-.57735,-.57735,.57735,-.62694,.25969,.73451,-.25969,.62694,.73451,.57735,.57735,.57735,.40825,.8165,.40825,-.29289,.91018,-.29289,-.29289,.91018,-.29289,.40825,.8165,.40825,.57735,.57735,.57735,.73451,.62694,-.25969,.57735,-.57735,.57735,.8165,-.40825,.40825,.57735,-.57735,.57735,.30151,-.90453,.30151,.30151,-.30151,.90453,.57735,-.57735,.57735,.8165,-.40825,.40825,.57735,-.57735,.57735,.57735,-.57735,.57735,.40825,-.8165,.40825,.57735,-.57735,.57735,.30151,-.30151,.90453,.57735,-.57735,.57735,.40825,-.8165,.40825,.57735,-.57735,.57735,.90453,-.30151,.30151,.30151,-.90453,.30151,.57735,-.57735,.57735,.40825,-.40825,.8165,.57735,-.57735,.57735,.57735,-.57735,.57735,.40825,-.40825,.8165,.57735,-.57735,.57735,.90453,-.30151,.30151,.73451,.25969,-.62694,.90453,-.30151,.30151,.57735,-.57735,.57735,.57735,-.57735,-.57735,.73451,.62694,-.25969,.90453,-.30151,.30151,.73451,.25969,-.62694,.73451,.62694,-.25969,.57735,.57735,.57735,.57735,-.57735,.57735,.90453,-.30151,.30151,-.25969,.62694,.73451,-.62694,.25969,.73451,.30151,-.30151,.90453,.57735,-.57735,.57735,.30151,-.30151,.90453,-.62694,.25969,.73451,-.57735,-.57735,.57735,.57735,-.57735,.57735,-.57735,-.57735,.57735,-.62694,-.73451,-.25969,.30151,-.90453,.30151,.30151,-.90453,.30151,-.62694,-.73451,-.25969,-.25969,-.73451,-.62694,.57735,.57735,.57735,-.25969,.62694,.73451,.30151,-.30151,.90453,.57735,-.57735,.57735,.57735,-.57735,.57735,.30151,-.90453,.30151,-.25969,-.73451,-.62694,.57735,-.57735,-.57735,.25969,.62694,.73451,.62694,.25969,.73451,.91018,.29289,-.29289,.29289,.91018,-.29289,.62694,-.73451,-.25969,.25969,-.73451,-.62694,.29289,.29289,-.91018,.91018,.29289,-.29289,-.73451,.25969,-.62694,-.73451,.62694,-.25969,.29289,.91018,-.29289,.29289,.29289,-.91018,.29289,.29289,-.91018,.29289,.91018,-.29289,.91018,.29289,-.29289,-.57735,-.57735,.57735,-.57735,-.57735,-.57735,-.40825,-.40825,-.8165,-.40825,-.40825,.8165,-.57735,-.57735,-.57735,-.57735,-.57735,.57735,-.40825,-.40825,.8165,-.40825,-.40825,-.8165,-.57735,.57735,.57735,-.57735,-.57735,.57735,-.40825,-.8165,.40825,-.40825,.8165,.40825,-.57735,-.57735,.57735,-.57735,.57735,.57735,-.40825,.8165,.40825,-.40825,-.8165,.40825,.57735,-.57735,.57735,-.57735,-.57735,.57735,-.8165,-.40825,.40825,.8165,-.40825,.40825,-.57735,-.57735,.57735,.57735,-.57735,.57735,.8165,-.40825,.40825,-.8165,-.40825,.40825,-.57735,-.57735,-.57735,-.40825,-.40825,-.8165,.29289,.29289,-.91018,.25969,-.73451,-.62694,-.40825,-.40825,-.8165,-.57735,-.57735,-.57735,-.73451,.25969,-.62694,.29289,.29289,-.91018,.91018,.29289,-.29289,.8165,-.40825,.40825,.57735,-.57735,.57735,.62694,-.73451,-.25969,.57735,-.57735,.57735,.8165,-.40825,.40825,.91018,.29289,-.29289,.62694,.25969,.73451,-.40825,.8165,.40825,-.57735,.57735,.57735,.25969,.62694,.73451,.29289,.91018,-.29289,-.57735,.57735,.57735,-.40825,.8165,.40825,.29289,.91018,-.29289,-.73451,.62694,-.25969,-.57735,-.57735,.57735,-.8165,-.40825,.40825,-.57735,-.57735,.57735,-.30151,-.90453,.30151,-.8165,-.40825,.40825,-.57735,-.57735,.57735,-.30151,-.30151,.90453,-.57735,-.57735,.57735,-.57735,-.57735,.57735,-.40825,-.8165,.40825,-.57735,-.57735,.57735,-.30151,-.30151,.90453,-.57735,-.57735,.57735,-.40825,-.8165,.40825,-.57735,-.57735,.57735,-.90453,-.30151,.30151,-.40825,-.40825,.8165,-.57735,-.57735,.57735,-.30151,-.90453,.30151,-.57735,-.57735,.57735,-.57735,-.57735,.57735,-.40825,-.40825,.8165,-.57735,-.57735,.57735,-.90453,-.30151,.30151,-.57735,-.57735,.57735,-.90453,-.30151,.30151,-.73451,.25969,-.62694,-.57735,-.57735,-.57735,-.90453,-.30151,.30151,-.73451,.62694,-.25969,-.73451,.25969,-.62694,-.57735,-.57735,.57735,-.57735,.57735,.57735,-.73451,.62694,-.25969,-.90453,-.30151,.30151,.62694,.25969,.73451,.25969,.62694,.73451,-.30151,-.30151,.90453,.62694,.25969,.73451,-.30151,-.30151,.90453,-.57735,-.57735,.57735,.57735,-.57735,.57735,.62694,-.73451,-.25969,.57735,-.57735,.57735,-.57735,-.57735,.57735,-.30151,-.90453,.30151,.62694,-.73451,-.25969,-.30151,-.90453,.30151,.25969,-.73451,-.62694,-.30151,-.30151,.90453,.25969,.62694,.73451,-.57735,.57735,.57735,-.57735,-.57735,.57735,.25969,-.73451,-.62694,-.30151,-.90453,.30151,-.57735,-.57735,.57735,-.57735,-.57735,-.57735,-.25969,-.62694,.73451,-.62694,-.25969,.73451,-.91018,-.29289,-.29289,-.29289,-.91018,-.29289,-.62694,.73451,-.25969,-.25969,.73451,-.62694,-.29289,-.29289,-.91018,-.91018,-.29289,-.29289,.73451,-.25969,-.62694,.73451,-.62694,-.25969,-.29289,-.91018,-.29289,-.29289,-.29289,-.91018,-.29289,-.29289,-.91018,-.29289,-.91018,-.29289,-.91018,-.29289,-.29289,.57735,.57735,.57735,.57735,.57735,-.57735,.40825,.40825,-.8165,.40825,.40825,.8165,.57735,.57735,-.57735,.57735,.57735,.57735,.40825,.40825,.8165,.40825,.40825,-.8165,.57735,-.57735,.57735,.57735,.57735,.57735,.40825,.8165,.40825,.40825,-.8165,.40825,.57735,.57735,.57735,.57735,-.57735,.57735,.40825,-.8165,.40825,.40825,.8165,.40825,-.57735,.57735,.57735,.57735,.57735,.57735,.8165,.40825,.40825,-.8165,.40825,.40825,.57735,.57735,.57735,-.57735,.57735,.57735,-.8165,.40825,.40825,.8165,.40825,.40825,.57735,.57735,-.57735,.40825,.40825,-.8165,-.29289,-.29289,-.91018,-.25969,.73451,-.62694,.40825,.40825,-.8165,.57735,.57735,-.57735,.73451,-.25969,-.62694,-.29289,-.29289,-.91018,-.91018,-.29289,-.29289,-.8165,.40825,.40825,-.57735,.57735,.57735,-.62694,.73451,-.25969,-.57735,.57735,.57735,-.8165,.40825,.40825,-.91018,-.29289,-.29289,-.62694,-.25969,.73451,.40825,-.8165,.40825,.57735,-.57735,.57735,-.25969,-.62694,.73451,-.29289,-.91018,-.29289,.57735,-.57735,.57735,.40825,-.8165,.40825,-.29289,-.91018,-.29289,.73451,-.62694,-.25969,.57735,.57735,.57735,.8165,.40825,.40825,.57735,.57735,.57735,.30151,.90453,.30151,.8165,.40825,.40825,.57735,.57735,.57735,.30151,.30151,.90453,.57735,.57735,.57735,.57735,.57735,.57735,.40825,.8165,.40825,.57735,.57735,.57735,.30151,.30151,.90453,.57735,.57735,.57735,.40825,.8165,.40825,.57735,.57735,.57735,.90453,.30151,.30151,.40825,.40825,.8165,.57735,.57735,.57735,.30151,.90453,.30151,.57735,.57735,.57735,.57735,.57735,.57735,.40825,.40825,.8165,.57735,.57735,.57735,.90453,.30151,.30151,.57735,.57735,.57735,.90453,.30151,.30151,.73451,-.25969,-.62694,.57735,.57735,-.57735,.90453,.30151,.30151,.73451,-.62694,-.25969,.73451,-.25969,-.62694,.57735,.57735,.57735,.57735,-.57735,.57735,.73451,-.62694,-.25969,.90453,.30151,.30151,-.62694,-.25969,.73451,-.25969,-.62694,.73451,.30151,.30151,.90453,-.62694,-.25969,.73451,.30151,.30151,.90453,.57735,.57735,.57735,-.57735,.57735,.57735,-.62694,.73451,-.25969,-.57735,.57735,.57735,.57735,.57735,.57735,.30151,.90453,.30151,-.62694,.73451,-.25969,.30151,.90453,.30151,-.25969,.73451,-.62694,.30151,.30151,.90453,-.25969,-.62694,.73451,.57735,-.57735,.57735,.57735,.57735,.57735,-.25969,.73451,-.62694,.30151,.90453,.30151,.57735,.57735,.57735,.57735,.57735,-.57735,.91018,-.29289,-.29289,.62694,-.25969,.73451,.25969,-.62694,.73451,.29289,-.91018,-.29289,.29289,-.29289,-.91018,.25969,.73451,-.62694,.62694,.73451,-.25969,.91018,-.29289,-.29289,.29289,-.91018,-.29289,-.73451,-.62694,-.25969,-.73451,-.25969,-.62694,.29289,-.29289,-.91018,.29289,-.91018,-.29289,.29289,-.29289,-.91018,.91018,-.29289,-.29289,-.40825,.40825,-.8165,-.57735,.57735,-.57735,-.57735,.57735,.57735,-.40825,.40825,.8165,-.40825,.40825,.8165,-.57735,.57735,.57735,-.57735,.57735,-.57735,-.40825,.40825,-.8165,-.40825,.8165,.40825,-.57735,.57735,.57735,-.57735,-.57735,.57735,-.40825,-.8165,.40825,-.40825,-.8165,.40825,-.57735,-.57735,.57735,-.57735,.57735,.57735,-.40825,.8165,.40825,-.8165,.40825,.40825,-.57735,.57735,.57735,.57735,.57735,.57735,.8165,.40825,.40825,.8165,.40825,.40825,.57735,.57735,.57735,-.57735,.57735,.57735,-.8165,.40825,.40825,.29289,-.29289,-.91018,-.40825,.40825,-.8165,-.57735,.57735,-.57735,.25969,.73451,-.62694,-.73451,-.25969,-.62694,-.57735,.57735,-.57735,-.40825,.40825,-.8165,.29289,-.29289,-.91018,.57735,.57735,.57735,.8165,.40825,.40825,.91018,-.29289,-.29289,.62694,.73451,-.25969,.91018,-.29289,-.29289,.8165,.40825,.40825,.57735,.57735,.57735,.62694,-.25969,.73451,.25969,-.62694,.73451,-.57735,-.57735,.57735,-.40825,-.8165,.40825,.29289,-.91018,-.29289,.29289,-.91018,-.29289,-.40825,-.8165,.40825,-.57735,-.57735,.57735,-.73451,-.62694,-.25969,-.57735,.57735,.57735,-.8165,.40825,.40825,-.57735,.57735,.57735,-.30151,.90453,.30151,-.30151,.30151,.90453,-.57735,.57735,.57735,-.8165,.40825,.40825,-.57735,.57735,.57735,-.57735,.57735,.57735,-.40825,.8165,.40825,-.57735,.57735,.57735,-.30151,.30151,.90453,-.57735,.57735,.57735,-.40825,.8165,.40825,-.57735,.57735,.57735,-.90453,.30151,.30151,-.30151,.90453,.30151,-.57735,.57735,.57735,-.40825,.40825,.8165,-.57735,.57735,.57735,-.57735,.57735,.57735,-.40825,.40825,.8165,-.57735,.57735,.57735,-.90453,.30151,.30151,-.73451,-.25969,-.62694,-.90453,.30151,.30151,-.57735,.57735,.57735,-.57735,.57735,-.57735,-.73451,-.62694,-.25969,-.90453,.30151,.30151,-.73451,-.25969,-.62694,-.73451,-.62694,-.25969,-.57735,-.57735,.57735,-.57735,.57735,.57735,-.90453,.30151,.30151,.25969,-.62694,.73451,.62694,-.25969,.73451,-.30151,.30151,.90453,-.57735,.57735,.57735,-.30151,.30151,.90453,.62694,-.25969,.73451,.57735,.57735,.57735,-.57735,.57735,.57735,.57735,.57735,.57735,.62694,.73451,-.25969,-.30151,.90453,.30151,-.30151,.90453,.30151,.62694,.73451,-.25969,.25969,.73451,-.62694,-.57735,-.57735,.57735,.25969,-.62694,.73451,-.30151,.30151,.90453,-.57735,.57735,.57735,-.57735,.57735,.57735,-.30151,.90453,.30151,.25969,.73451,-.62694,-.57735,.57735,-.57735],colors:[],uvs:[[]],faces:[35,9,8,4,5,0,0,1,2,3,35,1,13,6,4,0,4,5,6,7,35,17,16,5,6,0,8,9,10,11,34,6,5,4,0,12,13,14,35,22,18,12,26,0,15,16,17,18,35,14,30,26,12,0,19,20,21,22,35,15,23,27,11,0,23,24,25,26,35,21,10,11,27,0,27,28,29,30,35,7,19,25,3,0,31,32,33,34,35,29,2,3,25,0,35,36,37,38,35,14,12,6,13,0,39,40,41,42,35,12,18,17,6,0,43,44,45,46,35,4,3,2,1,0,47,48,49,50,35,7,3,4,8,0,51,52,53,54,35,11,10,9,5,0,55,56,57,58,35,15,11,5,16,0,59,60,61,62,35,29,25,0,28,0,63,64,65,66,35,25,19,20,0,0,67,68,69,70,35,21,27,0,20,0,71,72,73,74,35,0,27,23,24,0,75,76,77,78,35,26,30,28,0,0,79,80,81,82,35,22,26,0,24,0,83,84,85,86,35,22,24,17,18,0,87,88,89,90,34,24,16,17,0,91,92,93,35,23,15,16,24,0,94,95,96,97,34,8,9,20,0,98,99,100,35,8,20,19,7,0,101,102,103,104,35,1,2,29,28,0,105,106,107,108,34,1,28,13,0,109,110,111,35,20,9,10,21,0,112,113,114,115,35,13,28,30,14,0,116,117,118,119,35,35,39,40,36,0,120,121,122,123,35,37,44,32,35,0,124,125,126,127,35,36,47,48,37,0,128,129,130,131,34,36,37,35,0,132,133,134,35,43,49,53,57,0,135,136,137,138,35,57,61,45,43,0,139,140,141,142,35,58,54,46,42,0,143,144,145,146,35,42,41,52,58,0,147,148,149,150,35,56,50,38,34,0,151,152,153,154,35,34,33,60,56,0,155,156,157,158,35,37,43,45,44,0,159,160,161,162,35,48,49,43,37,0,163,164,165,166,35,33,34,35,32,0,167,168,169,170,35,35,34,38,39,0,171,172,173,174,35,40,41,42,36,0,175,176,177,178,35,36,42,46,47,0,179,180,181,182,35,31,56,60,59,0,183,184,185,186,35,51,50,56,31,0,187,188,189,190,35,31,58,52,51,0,191,192,193,194,35,54,58,31,55,0,195,196,197,198,35,59,61,57,31,0,199,200,201,202,35,31,57,53,55,0,203,204,205,206,35,48,55,53,49,0,207,208,209,210,34,47,55,48,0,211,212,213,35,47,46,54,55,0,214,215,216,217,34,40,39,51,0,218,219,220,35,50,51,39,38,0,221,222,223,224,35,60,33,32,59,0,225,226,227,228,34,59,32,44,0,229,230,231,35,41,40,51,52,0,232,233,234,235,35,61,59,44,45,0,236,237,238,239,35,66,70,71,67,0,240,241,242,243,35,68,75,63,66,0,244,245,246,247,35,67,78,79,68,0,248,249,250,251,34,67,68,66,0,252,253,254,35,74,80,84,88,0,255,256,257,258,35,88,92,76,74,0,259,260,261,262,35,89,85,77,73,0,263,264,265,266,35,73,72,83,89,0,267,268,269,270,35,87,81,69,65,0,271,272,273,274,35,65,64,91,87,0,275,276,277,278,35,68,74,76,75,0,279,280,281,282,35,79,80,74,68,0,283,284,285,286,35,64,65,66,63,0,287,288,289,290,35,66,65,69,70,0,291,292,293,294,35,71,72,73,67,0,295,296,297,298,35,67,73,77,78,0,299,300,301,302,35,62,87,91,90,0,303,304,305,306,35,82,81,87,62,0,307,308,309,310,35,62,89,83,82,0,311,312,313,314,35,85,89,62,86,0,315,316,317,318,35,90,92,88,62,0,319,320,321,322,35,62,88,84,86,0,323,324,325,326,35,79,86,84,80,0,327,328,329,330,34,78,86,79,0,331,332,333,35,78,77,85,86,0,334,335,336,337,34,71,70,82,0,338,339,340,35,81,82,70,69,0,341,342,343,344,35,91,64,63,90,0,345,346,347,348,34,90,63,75,0,349,350,351,35,72,71,82,83,0,352,353,354,355,35,92,90,75,76,0,356,357,358,359,35,102,101,97,98,0,360,361,362,363,35,94,106,99,97,0,364,365,366,367,35,110,109,98,99,0,368,369,370,371,34,99,98,97,0,372,373,374,35,115,111,105,119,0,375,376,377,378,35,107,123,119,105,0,379,380,381,382,35,108,116,120,104,0,383,384,385,386,35,114,103,104,120,0,387,388,389,390,35,100,112,118,96,0,391,392,393,394,35,122,95,96,118,0,395,396,397,398,35,107,105,99,106,0,399,400,401,402,35,105,111,110,99,0,403,404,405,406,35,97,96,95,94,0,407,408,409,410,35,100,96,97,101,0,411,412,413,414,35,104,103,102,98,0,415,416,417,418,35,108,104,98,109,0,419,420,421,422,35,122,118,93,121,0,423,424,425,426,35,118,112,113,93,0,427,428,429,430,35,114,120,93,113,0,431,432,433,434,35,93,120,116,117,0,435,436,437,438,35,119,123,121,93,0,439,440,441,442,35,115,119,93,117,0,443,444,445,446,35,115,117,110,111,0,447,448,449,450,34,117,109,110,0,451,452,453,35,116,108,109,117,0,454,455,456,457,34,101,102,113,0,458,459,460,35,101,113,112,100,0,461,462,463,464,35,94,95,122,121,0,465,466,467,468,34,94,121,106,0,469,470,471,35,113,102,103,114,0,472,473,474,475,35,106,121,123,107,0,476,477,478,479,35,128,132,133,129,0,480,481,482,483,35,130,137,125,128,0,484,485,486,487,35,129,140,141,130,0,488,489,490,491,34,129,130,128,0,492,493,494,35,136,142,146,150,0,495,496,497,498,35,150,154,138,136,0,499,500,501,502,35,151,147,139,135,0,503,504,505,506,35,135,134,145,151,0,507,508,509,510,35,149,143,131,127,0,511,512,513,514,35,127,126,153,149,0,515,516,517,518,35,130,136,138,137,0,519,520,521,522,35,141,142,136,130,0,523,524,525,526,35,126,127,128,125,0,527,528,529,530,35,128,127,131,132,0,531,532,533,534,35,133,134,135,129,0,535,536,537,538,35,129,135,139,140,0,539,540,541,542,35,124,149,153,152,0,543,544,545,546,35,144,143,149,124,0,547,548,549,550,35,124,151,145,144,0,551,552,553,554,35,147,151,124,148,0,555,556,557,558,35,152,154,150,124,0,559,560,561,562,35,124,150,146,148,0,563,564,565,566,35,141,148,146,142,0,567,568,569,570,34,140,148,141,0,571,572,573,35,140,139,147,148,0,574,575,576,577,34,133,132,144,0,578,579,580,35,143,144,132,131,0,581,582,583,584,35,153,126,125,152,0,585,586,587,588,34,152,125,137,0,589,590,591,35,134,133,144,145,0,592,593,594,595,35,154,152,137,138,0,596,597,598,599,35,164,163,159,160,0,600,601,602,603,35,156,168,161,159,0,604,605,606,607,35,172,171,160,161,0,608,609,610,611,34,161,160,159,0,612,613,614,35,177,173,167,181,0,615,616,617,618,35,169,185,181,167,0,619,620,621,622,35,170,178,182,166,0,623,624,625,626,35,176,165,166,182,0,627,628,629,630,35,162,174,180,158,0,631,632,633,634,35,184,157,158,180,0,635,636,637,638,35,169,167,161,168,0,639,640,641,642,35,167,173,172,161,0,643,644,645,646,35,159,158,157,156,0,647,648,649,650,35,162,158,159,163,0,651,652,653,654,35,166,165,164,160,0,655,656,657,658,35,170,166,160,171,0,659,660,661,662,35,184,180,155,183,0,663,664,665,666,35,180,174,175,155,0,667,668,669,670,35,176,182,155,175,0,671,672,673,674,35,155,182,178,179,0,675,676,677,678,35,181,185,183,155,0,679,680,681,682,35,177,181,155,179,0,683,684,685,686,35,177,179,172,173,0,687,688,689,690,34,179,171,172,0,691,692,693,35,178,170,171,179,0,694,695,696,697,34,163,164,175,0,698,699,700,35,163,175,174,162,0,701,702,703,704,35,156,157,184,183,0,705,706,707,708,34,156,183,168,0,709,710,711,35,175,164,165,176,0,712,713,714,715,35,168,183,185,169,0,716,717,718,719,35,195,194,190,191,0,720,721,722,723,35,187,199,192,190,0,724,725,726,727,35,203,202,191,192,0,728,729,730,731,34,192,191,190,0,732,733,734,35,208,204,198,212,0,735,736,737,738,35,200,216,212,198,0,739,740,741,742,35,201,209,213,197,0,743,744,745,746,35,207,196,197,213,0,747,748,749,750,35,193,205,211,189,0,751,752,753,754,35,215,188,189,211,0,755,756,757,758,35,200,198,192,199,0,759,760,761,762,35,198,204,203,192,0,763,764,765,766,35,190,189,188,187,0,767,768,769,770,35,193,189,190,194,0,771,772,773,774,35,197,196,195,191,0,775,776,777,778,35,201,197,191,202,0,779,780,781,782,35,215,211,186,214,0,783,784,785,786,35,211,205,206,186,0,787,788,789,790,35,207,213,186,206,0,791,792,793,794,35,186,213,209,210,0,795,796,797,798,35,212,216,214,186,0,799,800,801,802,35,208,212,186,210,0,803,804,805,806,35,208,210,203,204,0,807,808,809,810,34,210,202,203,0,811,812,813,35,209,201,202,210,0,814,815,816,817,34,194,195,206,0,818,819,820,35,194,206,205,193,0,821,822,823,824,35,187,188,215,214,0,825,826,827,828,34,187,214,199,0,829,830,831,35,206,195,196,207,0,832,833,834,835,35,199,214,216,200,0,836,837,838,839,35,221,225,226,222,0,840,841,842,843,35,223,230,218,221,0,844,845,846,847,35,222,233,234,223,0,848,849,850,851,34,222,223,221,0,852,853,854,35,229,235,239,243,0,855,856,857,858,35,243,247,231,229,0,859,860,861,862,35,244,240,232,228,0,863,864,865,866,35,228,227,238,244,0,867,868,869,870,35,242,236,224,220,0,871,872,873,874,35,220,219,246,242,0,875,876,877,878,35,223,229,231,230,0,879,880,881,882,35,234,235,229,223,0,883,884,885,886,35,219,220,221,218,0,887,888,889,890,35,221,220,224,225,0,891,892,893,894,35,226,227,228,222,0,895,896,897,898,35,222,228,232,233,0,899,900,901,902,35,217,242,246,245,0,903,904,905,906,35,237,236,242,217,0,907,908,909,910,35,217,244,238,237,0,911,912,913,914,35,240,244,217,241,0,915,916,917,918,35,245,247,243,217,0,919,920,921,922,35,217,243,239,241,0,923,924,925,926,35,234,241,239,235,0,927,928,929,930,34,233,241,234,0,931,932,933,35,233,232,240,241,0,934,935,936,937,34,226,225,237,0,938,939,940,35,236,237,225,224,0,941,942,943,944,35,246,219,218,245,0,945,946,947,948,34,245,218,230,0,949,950,951,35,227,226,237,238,0,952,953,954,955,35,247,245,230,231,0,956,957,958,959]
});return a.geometry}function isInfinite(a){return!isFinite(a)}function RouteSegmentFailed(a){this.message=a,this.name="RouteSegmentFailed"}function buildGalaxy(){var a=new THREE.Geometry,b=new THREE.Geometry,c=new THREE.Geometry,d=new THREE.Geometry,e=new THREE.Geometry,f=new THREE.PointCloudMaterial({size:20,map:THREE.ImageUtils.loadTexture("images/galactic_stars.png"),blending:THREE.AdditiveBlending,vertexColors:!0,transparent:!0,depthTest:!1});f.color.setHSL(1,0,1);for(var g=new THREE.PointCloudMaterial({size:300,map:THREE.ImageUtils.loadTexture("images/galactic_clouds.png"),blending:THREE.AdditiveBlending,vertexColors:!0,transparent:!0,depthTest:!1}),h=[],i=0;1800>i;i++){var j=Math.random()*Math.PI*2,k=200*Math.random()+400,l=Math.cos(j)*k,m=70*Math.random()-35,n=Math.sin(j)*k,o=new THREE.Vector3(l,m,n);a.vertices.push(o);var p=106*Math.random()+185,q=32*Math.random()+34,r=28*Math.random()+72;h[i]=new THREE.Color(16777215),h[i].setHSL(p/360,q/100,r/100)}a.colors=h,h=[];for(var s=0;5e3>s;s++){var t=Math.random()*Math.PI*2,u=350*Math.random()+1,v=Math.cos(t)*u,w=200*Math.random()*(1/u)*(Math.random()>.5?1:-1),x=Math.sin(t)*u,y=new THREE.Vector3(v,w,x);c.vertices.push(y);var z=106*Math.random()+185,A=32*Math.random()+34,B=28*Math.random()+72;h[s]=new THREE.Color(16777215),h[s].setHSL(z/360,A/100,B/100)}c.colors=h,h=[];for(var C=0;200>C;C++){var D=Math.random()*Math.PI*2,E=350*Math.random()+1,F=Math.cos(D)*E,G=200*Math.random()*(1/E)*(Math.random()>.5?1:-1),H=Math.sin(D)*E,I=new THREE.Vector3(F,G,H);d.vertices.push(I);var J=106*Math.random()+185,K=32*Math.random()+34,L=28*Math.random()+72;h[C]=new THREE.Color(16777215),h[C].setHSL(J/360,K/100,L/100)}d.colors=h,h=[];for(var M=0;200>M;M++){var N=Math.random()*Math.PI*2,O=200*Math.random()+400,P=Math.cos(N)*O,Q=70*Math.random()-35,R=Math.sin(N)*O,S=new THREE.Vector3(P,Q,R);b.vertices.push(S);var T=106*Math.random()+185,U=32*Math.random()+34,V=28*Math.random()+72;h[M]=new THREE.Color(16777215),h[M].setHSL(T/360,U/100,V/100)}b.colors=h,h=[];for(var W=0;1e3>W;W++){var X=1e3*Math.random()+1e3,Y=Math.random()*(2*X)-X,Z=Math.random()*Math.PI*2,$=Math.asin(Y/X),_=Math.cos($)*Math.cos(Z)*X,aa=Math.cos($)*Math.sin(Z)*X,ba=Y,ca=new THREE.Vector3(_,aa,ba);e.vertices.push(ca),h[W]=new THREE.Color(16777215)}e.colors=h;var da=new THREE.PointCloud(a,f),ea=new THREE.PointCloud(c,f),fa=new THREE.PointCloud(d,g),ga=new THREE.PointCloud(b,g),ha=new THREE.PointCloud(e,f);scene.add(da),scene.add(ea),scene.add(fa),scene.add(ga),scene.add(ha)}function buildGalaxyPlane(){var a=new THREE.PlaneGeometry(300,300),b=new THREE.MeshBasicMaterial({color:255,side:THREE.DoubleSide}),c=new THREE.Mesh(a,b);c.rotation.x=3*Math.PI/2,scene.add(c)}function smokeTest(){var a=new THREE.Geometry;for(i=0;i<25;i++){var b=new THREE.Vector3(8*Math.random(),10*Math.random()+5,8*Math.random());a.vertices.push(b)}var c=THREE.ImageUtils.loadTexture("images/smoke.png"),d=new THREE.ParticleBasicMaterial({map:c,transparent:!0,blending:THREE.AdditiveBlending,size:25,color:1118481}),e=new THREE.ParticleSystem(a,d);e.sortParticles=!0,e.position.x=10,scene.add(e)}function buildCross(){var a=new THREE.MeshBasicMaterial({wireframe:!0,color:16711680,linewidth:1}),b=new THREE.Object3D,c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-50,1,0)),c.vertices.push(new THREE.Vector3(50,1,0));var d=new THREE.Line(c,a);b.add(d),c=new THREE.Geometry;var e=new THREE.MeshBasicMaterial({wireframe:!0,color:15790080,linewidth:1});c.vertices.push(new THREE.Vector3(0,1,-50)),c.vertices.push(new THREE.Vector3(0,1,50)),d=new THREE.Line(c,e),b.add(d);var f=new THREE.MeshBasicMaterial({wireframe:!0,color:240,linewidth:1});return c=new THREE.Geometry,c.vertices.push(new THREE.Vector3(0,-50,0)),c.vertices.push(new THREE.Vector3(0,50,0)),d=new THREE.Line(c,f),b.add(d),b}function smokeTest(){var a=new THREE.Geometry;for(i=0;i<25;i++){var b=new THREE.Vector3(8*Math.random(),10*Math.random()+5,8*Math.random());a.vertices.push(b)}var c=THREE.ImageUtils.loadTexture("images/smoke.png"),d=new THREE.ParticleBasicMaterial({map:c,transparent:!0,blending:THREE.AdditiveBlending,size:25,color:1118481}),e=new THREE.ParticleSystem(a,d);e.sortParticles=!0,e.position.x=10,scene.add(e)}function buildCross(){var a=new THREE.MeshBasicMaterial({wireframe:!0,color:16711680,linewidth:1}),b=new THREE.Object3D,c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-50,1,0)),c.vertices.push(new THREE.Vector3(50,1,0));var d=new THREE.Line(c,a);b.add(d),c=new THREE.Geometry;var e=new THREE.MeshBasicMaterial({wireframe:!0,color:15790080,linewidth:1});c.vertices.push(new THREE.Vector3(0,1,-50)),c.vertices.push(new THREE.Vector3(0,1,50)),d=new THREE.Line(c,e),b.add(d);var f=new THREE.MeshBasicMaterial({wireframe:!0,color:240,linewidth:1});return c=new THREE.Geometry,c.vertices.push(new THREE.Vector3(0,-50,0)),c.vertices.push(new THREE.Vector3(0,50,0)),d=new THREE.Line(c,f),b.add(d),b}function hasLocalStorage(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function hasSessionStorage(){try{return"sessionStorage"in window&&null!==window.sessionStorage}catch(a){return!1}}function humanSort(a,b){var c,d,e,f=a.name.split(/(\d+)/),g=b.name.split(/(\d+)/);for(c=0;c<Math.max(f.length,g.length);c++)if(f[c]!=g[c])return d=isNaN(parseInt(f[c],10))?f[c]:parseInt(f[c],10),e=isNaN(parseInt(g[c],10))?g[c]:parseInt(g[c],10),void 0===d||void 0===e?f.length-g.length:e>d?-1:1;return 0}if("undefined"==typeof jQuery)throw new Error("starcitizen-webgl-map requires jQuery");if("undefined"==typeof THREE)throw new Error("starcitizen-webgl-map requires THREE.js");var SCMAP=SCMAP||{REVISION:"3"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},SCMAP.data={factions:[],crime_levels:[],uee_strategic_values:[],goods:[],map:{},systems:[],systemsById:[]},SCMAP.Symbol={},SCMAP.Symbols={},SCMAP.Symbol.SIZE=24,SCMAP.Symbol.SPACING=2,SCMAP.Symbol.getTag=function(a){var b=$('<i title="'+a.description+'" class="fa fa-fw '+a.faClass+'"></i>');return b.css("color",a.color),b},SCMAP.Symbols.DANGER={code:"",scale:.9,faClass:"fa-warning",description:"Danger, hostile faction",color:"rgba(255,50,50,1.0)"},SCMAP.Symbols.WARNING={code:"",scale:.9,faClass:"fa-warning",description:"Warning, hostile environment",color:"rgba(255,117,25,1.0)"},SCMAP.Symbols.HANGAR={code:"",scale:1.15,faClass:"fa-home",description:"Hangar location",color:"rgba(255,255,255,1.0)",offset:new THREE.Vector2(-.25,2)},SCMAP.Symbols.INFO={code:"",scale:1,faClass:"fa-info-circle",description:"Information available",color:"rgba(255, 162, 255, 1.0)"},SCMAP.Symbols.TRADE={code:"",scale:.9,faClass:"fa-exchange",description:"Major trade hub",color:"rgba(255,255,0,1.0)",offset:new THREE.Vector2(0,-1)},SCMAP.Symbols.BANNED={code:"",scale:1,faClass:"fa-ban",description:"System off-limits",color:"rgba(255, 117, 25, 1.0)"},SCMAP.Symbols.AVOID={code:"",scale:1.2,faClass:"fa-times",description:"Avoid: do not route here",color:"rgba(255,50,50,1.0)"},SCMAP.Symbols.COMMENTS={code:"",scale:1,faClass:"fa-comment",description:"Your comments",color:"rgba(106, 187, 207, 1.0)",offset:new THREE.Vector2(0,-3)},SCMAP.Symbols.BOOKMARK={code:"",scale:1.05,faClass:"fa-bookmark",description:"Bookmarked",color:"rgba(102, 193, 0, 1.0)",offset:new THREE.Vector2(-1,1)},SCMAP.travelTimeAU=function(a){return SCMAP.approximateTraveltimePerAU*a},SCMAP.usersFaction=function(){return SCMAP.data.factionsByName.UEE},SCMAP.LYtoAU=63241.077,SCMAP.approximateTraveltimePerAU=2495,SCMAP.Settings=function(){this.storage=null,hasLocalStorage()&&(this.storage=window.localStorage),this.uiWidth=this.storage&&Number(this.storage["settings.uiWidth"])>0?Number(this.storage["settings.uiWidth"]):320,this.labelScale=this.storage&&Number(this.storage["settings.labelScale"])>0?Number(this.storage["settings.labelScale"]):$("#sc-map-configuration").data("defaultLabelScale")||1,this.labelScale=Math.max(Number($("#sc-map-configuration").data("minLabelScale"))||.4,Math.min(this.labelScale,$("#sc-map-configuration").data("maxLabelScale")||2)),this.labelOffset=this.storage&&Number(this.storage["settings.labelOffset"])>0?Number(this.storage["settings.labelOffset"]):$("#sc-map-configuration").data("defaultLabelOffset")||5,this.labelOffset=Math.max(Number($("#sc-map-configuration").data("minLabelOffset"))||-3.5,Math.min(this.labelOffset,$("#sc-map-configuration").data("maxLabelOffset")||7.5)),this.systemScale=this.storage&&Number(this.storage["settings.systemScale"])>0?Number(this.storage["settings.systemScale"]):$("#sc-map-configuration").data("defaultSystemScale")||1,this.systemScale=Math.max(Number($("#sc-map-configuration").data("minSystemScale"))||.5,Math.min(this.systemScale,$("#sc-map-configuration").data("maxSystemScale")||2)),this.glow=this.storage&&"0"===this.storage["settings.Glow"]?!1:!0,this.labels=this.storage&&"0"===this.storage["settings.Labels"]?!1:!0,this.labelIcons=this.storage&&"0"===this.storage["settings.LabelIcons"]?!1:!0,this.camera={camera:new THREE.Vector3(0,80,100),target:new THREE.Vector3(0,10,0),orientation:{theta:0,phi:.9616764178488756,radius:122.2}},this.effect={Antialias:!0,FXAA:!1,Bloom:!1},this.control={rotationLocked:this.storage&&"1"===this.storage["control.rotationLocked"]?!0:!1},this.renderer={Stats:this.storage&&"1"===this.storage["renderer.Stats"]?!0:!1},this.route={avoidHostile:!1,avoidOffLimits:!1,avoidUnknownJumppoints:!1},this.convertAndRemoveOldSettings(),this.cameraDefaults=JSON.parse(JSON.stringify(this.camera)),this.cameraDefaults.camera=new THREE.Vector3,this.cameraDefaults.camera.copy(this.camera.camera),this.cameraDefaults.target=new THREE.Vector3,this.cameraDefaults.target.copy(this.camera.target),this.load("camera"),this.storage&&"route"in this.storage&&this.load("route"),this.load("systems"),this.systems||(this.systems={}),this.load("effect"),this.mode=this.storage&&"2d"===this.storage.mode?"2d":"3d",this.mergeAndRemoveOldSettings(),this.save("systems")},SCMAP.Settings.prototype={constructor:SCMAP.Settings,load:function(a){if(this.storage&&a in this.storage)try{this[a]=JSON.parse(this.storage[a])}catch(b){console.error("Error parsing 'localStorage."+a+"'; "+b.name+": "+b.message)}},save:function(a){this.storage&&a in this&&(this.storage[a]=JSON.stringify(this[a]))},convertAndRemoveOldSettings:function(){this.storage&&("effect.Bloom"in this.storage&&(this.effect.Bloom="1"===this.storage["effect.Bloom"]?!0:!1,delete this.storage["effect.Bloom"]),"effect.FXAA"in this.storage&&(this.effect.FXAA="1"===this.storage["effect.FXAA"]?!0:!1,delete this.storage["effect.FXAA"]),delete this.storage["camera.x"],delete this.storage["camera.y"],delete this.storage["camera.z"],delete this.storage["target.x"],delete this.storage["target.y"],delete this.storage["target.z"])},mergeAndRemoveOldSettings:function(){var a,b,c;if(this.storage)for(a in this.storage)this.storage.hasOwnProperty(a)&&(b=a.match(/^bookmarks[.](\d+)$/),b&&"1"===this.storage[a]&&(c=b[1],"object"!==this.systems[c]&&(this.systems[c]={}),this.systems[c].bookmarked=!0,delete this.storage[a]),b=a.match(/^hangarLocation[.](\d+)$/),b&&"1"===this.storage[a]&&(c=b[1],"object"!==this.systems[c]&&(this.systems[c]={}),this.systems[c].hangarLocation=!0,delete this.storage[a]),b=a.match(/^comments[.](\d+)$/),b&&""!==this.storage[a]&&(c=b[1],"object"!==this.systems[c]&&(this.systems[c]={}),this.systems[c].comments=this.storage[a],delete this.storage[a]))}},SCMAP.settings=new SCMAP.Settings,SCMAP.SelectedSystemGeometry=SCMAP.SelectedSystemGeometry||_build_selected_system_object(),SCMAP.JumpPoint=function(a){this.id=a.jumpPointId,this.name="string"==typeof a.name&&a.name.length>1?a.name:void 0,this.source=a.source instanceof SCMAP.System?a.source:void 0,this.destination=a.destination instanceof SCMAP.System?a.destination:void 0,this.drawn=!1,this.type="string"==typeof a.type?a.type:"UNDISC",this.entryAU=new THREE.Vector3,"object"==typeof a.entryAU&&Array.isArray(a.entryAU)&&(this.entryAU=this.entryAU.fromArray(a.entryAU)),this.isValid()?(void 0===this.name||""===this.name)&&(this.name="["+this.source.name+" to "+this.destination.name+"]"):console.error("Invalid route created")},SCMAP.JumpPoint.prototype={constructor:SCMAP.JumpPoint,length:function(){return this.isValid()?this.source.position.distanceTo(this.destination.position):void 0},jumpTime:function(){return this.isValid()?4*this.length():void 0},fuelConsumption:function(){return this.isValid()?0:void 0},buildSceneObject:function(){var a,b;if(!(this.drawn||(a=this.getOppositeJumppoint(),a instanceof SCMAP.JumpPoint&&a.drawn)))return b=new THREE.Geometry,b.colors.push(this.source.faction.lineColor),b.vertices.push(this.source.sceneObject.position),b.colors.push(this.destination.faction.lineColor),b.vertices.push(this.destination.sceneObject.position),this.setDrawn(),a instanceof SCMAP.JumpPoint&&a.setDrawn(),b.computeLineDistances(),new THREE.Line(b,this.getMaterial(),THREE.LinePieces)},getOppositeJumppoint:function(){for(var a=0;a<this.destination.jumpPoints.length;a++){var b=this.destination.jumpPoints[a];if(b.destination==this.source)return b}},getMaterial:function(){return this.type in SCMAP.JumpPoint.Material?SCMAP.JumpPoint.Material[this.type]:SCMAP.JumpPoint.Material.DEFAULT},isValid:function(){return this.source instanceof SCMAP.System&&this.destination instanceof SCMAP.System&&this.source!==this.destination},isUnconfirmed:function(){return"UNCONF"===this.type||"UNDISC"===this.type},setDrawn:function(){this.drawn=!0}},SCMAP.JumpPoint.Material={NORMAL:new THREE.LineBasicMaterial({color:16777215,linewidth:2,vertexColors:!0}),UNDISC:new THREE.LineDashedMaterial({color:16777215,dashSize:.75,gapSize:.75,linewidth:2,vertexColors:!0}),UNCONF:new THREE.LineDashedMaterial({color:16777215,dashSize:2,gapSize:2,linewidth:2,vertexColors:!0})},SCMAP.JumpPoint.Material.DEFAULT=SCMAP.JumpPoint.Material.UNCONF,SCMAP.Faction=function(a){this.id=void 0,this.name="Unclaimed",this.isRealFaction=!1,this.color=new THREE.Color(16777215),this.planeColor=new THREE.Color(16711680),this.lineColor=new THREE.Color(16776960),this.parentFaction=null,this.setValues(a),this._claimed={systems:{}},this._darkMaterial=void 0},SCMAP.Faction.prototype={constructor:SCMAP.Faction,claim:function(a){return!a instanceof SCMAP.System?void new Error("A faction can only claim ownership over a system"):(this._claimed.systems[a.uuid]=!0,this)},claimed:function(a){return!a instanceof SCMAP.System?void new Error("A faction can only test ownership over a system"):this._claimed.systems[a.uuid]},material:function(){return"undefined"==typeof this._darkMaterial&&(this._darkMaterial=new THREE.MeshBasicMaterial({color:this.planeColor,vertexColors:!0})),this._darkMaterial},isHostileTo:function(a){if(!(a instanceof SCMAP.Faction))throw"Can only compare to other factions";return"Vanduul"===a.name?"Vanduul"!==this.name:"Vanduul"===this.name},getValue:function(a){if(void 0!==a){var b=this[a];return b}},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0!==c){if(b in this){var d=this[b];d instanceof THREE.Color?(c instanceof THREE.Color?this[b]=c:(c=c.replace("0x","#"),this[b]=new THREE.Color(c)),"color"===b&&(this.planeColor=this[b].clone().offsetHSL(0,.5,0).multiplyScalar(.2),this.lineColor=this[b].clone().offsetHSL(0,.05,-.05))):this[b]=c}}else console.log('SCMAP.Faction: "'+b+'" parameter is undefined for "'+this.name+'"')}}},SCMAP.Faction.preprocessFactions=function(a){var b,c;SCMAP.data.factionsByName={};for(b in a)a.hasOwnProperty(b)&&(c=a[b],c instanceof SCMAP.Faction||(c=new SCMAP.Faction({id:b,name:c.name,color:c.color,isRealFaction:c.isRealFaction,parentFaction:null})),SCMAP.data.factions[b]=c,SCMAP.data.factionsByName[c.id]=c,SCMAP.data.factionsByName[c.name]=c)},SCMAP.Faction.getById=function(a){var b=SCMAP.data.factions[a];return b instanceof SCMAP.Faction||(b=SCMAP.data.factionsByName.Unclaimed),b},SCMAP.Faction.getByName=function(a){var b=SCMAP.data.factionsByName[a];return b instanceof SCMAP.Faction||(b=SCMAP.data.factionsByName.Unclaimed),b},SCMAP.Goods=function(a){this.id=void 0,this.name="Unknown",this.blackMarket=!1,this.setValues(a),this._trade={importing:[],exporting:[],blackMarket:[]}},SCMAP.Goods.prototype={constructor:SCMAP.Goods,getValue:function(a){if(void 0!==a){var b=this[a];return b}},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0!==c){if(b in this){this[b];this[b]=c}}else console.log('SCMAP.Goods: "'+b+'" parameter is undefined for "'+this.name+'"')}}},SCMAP.Goods.preprocessGoods=function(a){var b,c;SCMAP.data.goodsByName={};for(b in SCMAP.data.goods)if(SCMAP.data.goods.hasOwnProperty(b)){if(c=SCMAP.data.goods[b],c instanceof SCMAP.Goods){SCMAP.data.goodsByName[c.name]=c;continue}c=new SCMAP.Goods({id:b,name:c.name,blackMarket:c.blackMarket}),SCMAP.data.goods[b]=c,SCMAP.data.goodsByName[c.name]=c}},SCMAP.Goods.getById=function(a){return SCMAP.data.goods[a]},SCMAP.Goods.getByName=function(a){return SCMAP.data.goodsByName[a]},SCMAP.System=function(a){this.id=void 0,this.uuid=void 0,this.name=THREE.Math.generateUUID(),this.nickname="",this.position=new THREE.Vector3,this.faction=new SCMAP.Faction,this.size="medium",this.jumpPoints=[],this.poi=[],this.color=new THREE.Color(16777215),this.planets=0,this.planetaryRotation=[],this["import"]=[],this["export"]=[],this.status="unknown",this.crimeStatus="",this.blackMarket=[],this.ueeStrategicValue=void 0,this.info=[],this.scale=1,this.binary=!1,this.isOffLimits=!1,this.hasWarning=!1,this.isMajorTradeHub=!1,this.setValues(a),this._routeObjects=[],this._drawnText="",this._drawnSymbols=""},SCMAP.System.prototype={constructor:SCMAP.System,buildSceneObject:function(){var a,b,c,d,e,f=new THREE.Object3D;a=new THREE.Sprite(SCMAP.System.INTERACTABLE_DEBUG_MATERIAL),b=Math.min(5.75,Math.max(5.5,6*this.scale)),a.scale.set(b,b,b),f.userData.interactable=a,f.add(a);var g=this.scale*SCMAP.settings.systemScale;for(c=new THREE.LOD,i=0;i<SCMAP.System.STAR_LOD_MESHES.length;i++)d=new THREE.Mesh(SCMAP.System.STAR_LOD_MESHES[i][0],this.starMaterial()),d.scale.set(this.scale,this.scale,this.scale),d.updateMatrix(),d.matrixAutoUpdate=!1,c.addLevel(d,SCMAP.System.STAR_LOD_MESHES[i][1]);return c.scale.set(SCMAP.settings.systemScale,SCMAP.settings.systemScale,SCMAP.settings.systemScale),c.updateMatrix(),c.matrixAutoUpdate=!1,c.userData.scale=SCMAP.settings.systemScale,c.userData.isSystem=!0,f.userData.starLOD=c,f.add(c),e=new THREE.Sprite(this.glowMaterial()),e.scale.set(SCMAP.System.GLOW_SCALE*g,SCMAP.System.GLOW_SCALE*g,1),e.position.set(0,0,-.2),e.userData.isGlow=!0,e.userData.scale=this.scale,e.sortParticles=!0,e.visible=SCMAP.settings.glow,f.userData.glowSprite=e,f.add(e),this.systemLabel=this.systemLabel(SCMAP.settings.labelIcons),this.systemLabel&&this.systemLabel.sceneObject&&(this.systemLabel.sceneObject.userData.isLabel=!0,this.systemLabel.sceneObject.visible=SCMAP.settings.labels,f.add(this.systemLabel.sceneObject)),f.position.copy(this.position),storage&&"2d"===storage.mode&&f.position.setY(.005*f.position.y),f.userData.system=this,f.userData.scaleY=this.scaleY,f},updateSceneObject:function(a){for(var b=0;b<this.sceneObject.children.length;b++){var c=this.sceneObject.children[b];c.userData.isLabel?(this.systemLabel instanceof SCMAP.SystemLabel&&this.systemLabel.update(SCMAP.settings.labelIcons),c.visible=SCMAP.settings.labels):c.userData.isGlow&&(c.visible=SCMAP.settings.glow)}},setLabelScale:function(a){for(var b=0;b<this.sceneObject.children.length;b++)this.sceneObject.children[b].userData.isLabel&&this.sceneObject.children[b].scale.copy(a)},starMaterial:function(){return SCMAP.System.STAR_MATERIAL},glowMaterial:function(){var a=this.color;return a.equals(SCMAP.Color.BLACK)&&a.copy(SCMAP.Color.UNSET),new THREE.SpriteMaterial({map:SCMAP.System.GLOW_MAP,blending:THREE.AdditiveBlending,useScreenCoordinates:!1,color:a})},systemLabel:function(a){var b,c;return SCMAP.UI.fontAwesomeIsReady||(a=!1),b=new SCMAP.SystemLabel(this),(c=window.renderer.textureManager.allocateTextureNode(b.width(),b.height()))?(b.node=c,b.drawText(),a&&b.drawSymbols(),c.setUV(),b.sceneObject=new THREE.Sprite(new THREE.SpriteMaterial({map:c.texture})),b.sceneObject.addEventListener("removed",function(){b.sceneObject.userData.systemLabel=null}),b.sceneObject.userData.systemLabel=b,b.positionSprite(window.renderer.cameraRotationMatrix()),b.scaleSprite(),b):null},createInfoLink:function(a,b){var c=$("<a></a>");if("undefined"!=typeof this.faction&&"undefined"!=typeof this.faction&&c.css("color",this.faction.color.getStyle()),c.addClass("system-link"),c.attr("data-goto","system"),c.attr("data-system",this.id),c.attr("href","#system="+encodeURIComponent(this.name)),c.attr("title","Show information on "+this.name),b?c.text(this.name):c.html('<i class="fa fa-crosshairs"></i>&nbsp;'+this.name),!a){var d=this.getSymbols();if(d.length){for(var e=$('<span class="icons"></span>'),f=0;f<d.length;f++)e.append(SCMAP.Symbol.getTag(d[f]));c.append(e)}}return c},symbolsToKey:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].code);return b.join(";")},getIcons:function(){return this.getSymbols()},getSymbols:function(){var a=[];return this.faction.isHostileTo(SCMAP.usersFaction())&&a.push(SCMAP.Symbols.DANGER),this.hasWarning&&a.push(SCMAP.Symbols.WARNING),this.info.length&&a.push(SCMAP.Symbols.INFO),this.isMajorTradeHub&&a.push(SCMAP.Symbols.TRADE),this.isOffLimits&&a.push(SCMAP.Symbols.BANNED),this.hasHangar()&&a.push(SCMAP.Symbols.HANGAR),this.isBookmarked()&&a.push(SCMAP.Symbols.BOOKMARK),this.isToBeAvoided()&&a.push(SCMAP.Symbols.AVOID),this.hasComments()&&a.push(SCMAP.Symbols.COMMENTS),a},displayInfo:function(a){var b=this,c=null,d=null,e=window.map.route().indexOfCurrentRoute(this);if("number"==typeof e){var f=window.map.route().currentRoute();e>0&&(c=f[e-1].system,e>1&&c===f[e].system&&(c=f[e-2].system),c=c),e<f.length-1&&(d=f[e+1].system,e<f.length-2&&d===f[e].system&&(d=f[e+2].system))}var g=$(SCMAP.UI.Tab("system").id).empty().append(SCMAP.UI.Templates.systemInfo({previous:c,system:b,next:d}));g.find(".user-system-ishangar").prop("checked",this.hasHangar()).attr("data-system",this.id),g.find(".user-system-bookmarked").prop("checked",this.isBookmarked()).attr("data-system",this.id),g.find(".user-system-avoid").prop("checked",this.isToBeAvoided()).attr("data-system",this.id),this.hasComments()?(g.find(".user-system-comments").empty().val(this.getComments()),g.find(".user-system-comments-md").html($(markdown.toHTML(this.getComments())))):(g.find(".user-system-comments").empty().val(""),g.find(".user-system-comments-md").empty()),a||(ui.toTab("system"),ui.updateHeight())},scaleY:function(a,b){var c=a.userData.system.position.y*(b/100);return a.userData.system.sceneObject.translateY(c-a.userData.system.sceneObject.position.y),a.userData.system.routeNeedsUpdate(),this},moveTo:function(a){return this.system.sceneObject.position.copy(a),this.system.routeNeedsUpdate(),this},translateVector:function(a){return this.system.sceneObject.add(a),this.system.routeNeedsUpdate(),this},routeNeedsUpdate:function(){for(var a=0;a<this._routeObjects.length;a++)this._routeObjects[a].geometry.verticesNeedUpdate=!0;return this},jumpPointTo:function(a){for(var b=0;b<this.jumpPoints.length;b++)if(this.jumpPoints[b].destination===a)return this.jumpPoints[b]},isBookmarked:function(){return this.storedSettings().bookmarked===!0},isUnknown:function(){return"unknown"===this.status?!0:!1},setBookmarkedState:function(a){return this.storedSettings().bookmarked=a?!0:!1,this.saveSettings(),this},hasHangar:function(){return this.storedSettings().hangarLocation===!0},setHangarState:function(a){return this.storedSettings().hangarLocation=a?!0:!1,this.saveSettings(),this},isToBeAvoided:function(){return this.storedSettings().avoid===!0},setToBeAvoidedState:function(a){return this.storedSettings().avoid=a?!0:!1,this.saveSettings(),this},hasComments:function(){return"string"==typeof this.storedSettings().comments&&this.storedSettings().comments.length>0},getComments:function(){return this.storedSettings().comments},setComments:function(a){return"string"==typeof a&&a.length>1?this.storedSettings().comments=a:delete this.storedSettings().comments,this.saveSettings(),this},storedSettings:function(){return this.id in SCMAP.settings.systems||(SCMAP.settings.systems[this.id]={}),SCMAP.settings.systems[this.id]},saveSettings:function(){return SCMAP.settings.save("systems"),this},toString:function(){return this.name},getValue:function(a){if(void 0!==a){var b=this[a];return b}},factionStyle:function(){return this.faction.color.getStyle()},_fixJumpPoints:function(a){var b,c,d,e=[];for(b=0;b<this.jumpPoints.length;b++)c=this.jumpPoints[b],c instanceof SCMAP.JumpPoint||(d=SCMAP.System.getById(c.destinationSystemId),d instanceof SCMAP.System&&(c=new SCMAP.JumpPoint({source:this,destination:d,name:c.name,type:c.type,entryAU:c.coordsAu}),a?e.push(c):system.jumpPoints[b]=c));return a&&(this.jumpPoints=e),this},setValues:function(a){var b,c,d;if(void 0!==a)for(b in a)if(d=a[b],void 0!==d){if(b in this){if(c=this[b],"size"==b){switch(d){case"dwarf":this.scale=.9;break;case"medium":this.scale=1;break;case"large":this.scale=1.15;break;case"giant":this.scale=1.27;break;case"binary":this.scale=1.4,this.binary=!0}this[b]=d}c instanceof THREE.Color?d instanceof THREE.Color?this[b]=d:(d=d.replace("0x","#"),this["_"+b]=d,this[b]=new THREE.Color(d)):c instanceof SCMAP.Faction?this[b]=d.claim(this):c instanceof THREE.Vector3&&d instanceof THREE.Vector3?c.copy(d):c instanceof THREE.Vector3?d instanceof THREE.Vector3?c.copy(d):d instanceof Array&&c.fromArray(d):this[b]=d}}else console.log('SCMAP.System: "'+b+'" parameter is undefined for "'+this.name+'"')}},SCMAP.System.preprocessSystems=function(a){var b,c,d=[];SCMAP.data.systems={},SCMAP.data.systemsById={},SCMAP.System.List=[];for(b in a)a.hasOwnProperty(b)&&(c=SCMAP.System.fromJSON(a[b]),SCMAP.data.systems[c.name]=c,SCMAP.data.systemsById[c.id]=c,SCMAP.data.systemsById[c.uuid]=c,d.push(c));$(d).each(function(a,b){b._fixJumpPoints(!0)}),SCMAP.System.List=SCMAP.System.SortSystemList(d)},SCMAP.System.List=[],SCMAP.System.SortSystemList=function(a){for(var b=[],c=a.length;c--;)b[c]=a[c];var d=b.sort(humanSort);return d},SCMAP.System.fromJSON=function(a){return a instanceof SCMAP.System?a:new SCMAP.System({id:a.systemId,uuid:a.uuid,name:a.name,position:a.coords,scale:a.scale||1,color:a.color,faction:SCMAP.Faction.getById(a.factionId),isMajorTradeHub:a.isMajorTradeHub,hasWarning:a.hasWarning,isOffLimits:a.isOffLimits,nickname:a.nickname,size:a.size,info:a.info,status:a.status,crimeStatus:SCMAP.data.crimeLevels[a.crimeLevel],ueeStrategicValue:SCMAP.data.ueeStrategicValues[""+a.ueeStrategicValue],"import":a["import"],"export":a["export"],blackMarket:a.blackMarket,planets:[],planetaryRotation:[],jumpPoints:a.jumpPoints})},SCMAP.System.getByName=function(a){return SCMAP.data.systems[a]},SCMAP.System.getById=function(a){return SCMAP.data.systemsById[a]},SCMAP.Color={},SCMAP.Color.BLACK=new THREE.Color("black"),SCMAP.Color.UNSET=new THREE.Color(8429772),SCMAP.System.COLORS={RED:16736352,BLUE:6316287,WHITE:16777215,YELLOW:16777056,ORANGE:15790208,UNKNOWN:16777215},SCMAP.System.LABEL_SCALE=5,SCMAP.System.GLOW_SCALE=5.5,SCMAP.System.UNKNOWN_SYSTEM_SCALE=.65,SCMAP.System.STAR_LOD_MESHES=[[new THREE.IcosahedronGeometry(1,3),20],[new THREE.IcosahedronGeometry(1,2),150],[new THREE.IcosahedronGeometry(1,1),250],[new THREE.IcosahedronGeometry(1,0),500]],SCMAP.System.STAR_MATERIAL=new THREE.MeshBasicMaterial({color:SCMAP.System.COLORS.WHITE,name:"STAR_MATERIAL"}),SCMAP.System.INTERACTABLE_DEBUG_MATERIAL=new THREE.MeshBasicMaterial,SCMAP.System.INTERACTABLE_DEBUG_MATERIAL.color=16776960,SCMAP.System.INTERACTABLE_DEBUG_MATERIAL.depthWrite=!1,SCMAP.System.INTERACTABLE_DEBUG_MATERIAL.map=null,SCMAP.System.INTERACTABLE_DEBUG_MATERIAL.blending=THREE.AdditiveBlending,SCMAP.System.GLOW_MAP=new THREE.ImageUtils.loadTexture($("#sc-map-configuration").data("glow-image")),SCMAP.Dijkstra=function(a,b,c){if("object"!=typeof a||!Array.isArray(a))return void console.error("No array specified to SCMAP.Dijkstra constructor!");for(this.start=b instanceof SCMAP.System?b:null,this.end=this.start&&c instanceof SCMAP.System?c:null,this._nodes=[],this._mapping={},i=a.length;i--;)this._nodes[i]={system:a[i],distance:Number.POSITIVE_INFINITY,previous:null},this._mapping[a[i].id]=this._nodes[i];this._result={}},SCMAP.Dijkstra.prototype={constructor:SCMAP.Dijkstra,buildGraph:function(a,b){var c,d,e,f,g,h,i;new Date;if(!(this.start instanceof SCMAP.System))throw new Error("No source given");if(!(this.end instanceof SCMAP.System))throw new Error("No or invalid destination given");if(this._result.destination=this.end,b||!(this._result.source instanceof SCMAP.System)||this._result.source!==this.start||this._result.priority!==a){for(this.destroyGraph(),this._result.source=this.start,this._result.destination=this.end,this._result.priority=a,d=0;d<this._nodes.length;d++)this._nodes[d].distance=Number.POSITIVE_INFINITY,this._nodes[d].previous=null;for(f=this._mapping[this.start.id],f.distance=0,f.previous=null,c=SCMAP.Dijkstra.quickSort(this._nodes);c.length&&(f=c[0],f.system!==this.end)&&(c.splice(0,1),!isInfinite(f.distance));)for(d=0;d<f.system.jumpPoints.length;d++)if(g=f.system.jumpPoints[d],h=this._mapping[g.destination.id],!g.isUnconfirmed()||!SCMAP.settings.route.avoidUnknownJumppoints){if(!this.isStartOrEnd(h.system)){if(SCMAP.settings.route.avoidHostile&&!f.system.faction.isHostileTo(SCMAP.usersFaction())&&h.system.faction.isHostileTo(SCMAP.usersFaction()))continue;if(SCMAP.settings.route.avoidOffLimits&&h.system.isOffLimits)continue;if(!f.system.isToBeAvoided()&&h.system.isToBeAvoided())continue}e=f.distance+g.jumpTime(),e+=null===f.previous?SCMAP.travelTimeAU(.35):SCMAP.travelTimeAU(.7),SCMAP.settings.route.avoidHostile&&h.system.faction.isHostileTo(SCMAP.usersFaction())&&(e*=15),e<h.distance&&(h.distance=e,h.previous=f,c=SCMAP.Dijkstra.quickSort(c))}this._result.nodes=c,this._result.priority=a,i=new Date}},isStartOrEnd:function(a){return a instanceof SCMAP.System?a===this.start||a===this.end:!1},firstNode:function(){var a=this.routeArray();return a[0]},lastNode:function(){var a=this.routeArray();return a[a.length-1]},source:function(){return this.start instanceof SCMAP.System?this.start:void 0},destination:function(){return this.end instanceof SCMAP.System?this.end:void 0},rebuildGraph:function(){return this.destroyGraph(),this.start instanceof SCMAP.System?(this.buildGraph("time",!0),!0):void 0},destroyGraph:function(){this._result={}},routeArray:function(a){if(!(a instanceof SCMAP.System)){if(!(this._result.destination instanceof SCMAP.System))return void console.error("No or invalid destination specified.");a=this._result.destination}if(this._result.nodes.length>0){for(var b=[],c=this._mapping[a.id],d={};null!==c;)d[c.system.name]=!0,b.push(c),c=c.previous;return b.reverse(),b}}},SCMAP.Dijkstra.quickSort=function(a){for(var b=[],c=a.length;c--;)b[c]=a[c];if(b.length<=1)return b;var d=[],e=[],f=Math.ceil(b.length/2)-1;for(f=b.splice(f,1)[0],c=0;c<b.length;c++)b[c].distance<=f.distance?d.push(b[c]):e.push(b[c]);var g=SCMAP.Dijkstra.quickSort(d),h=SCMAP.Dijkstra.quickSort(e);return g.push(f),g.concat(h)},SCMAP.Route=function(a,b){if(this.start=a instanceof SCMAP.System?a:null,this.waypoints=[],this._graphs=[],this._routeObject=void 0,this._error=void 0,b instanceof SCMAP.System)this.waypoints=[b];else if(Array.isArray(b))for(var c=0,d=b.length;d>c;c+=1)b[c]instanceof SCMAP.System&&this.waypoints.push(b[c]);this.__syncGraphs()},SCMAP.Route.prototype={constructor:SCMAP.Route,__findGraphs:function(a){for(var b=[],c={},d=0,e=this._graphs.length;e>d;d+=1){var f=[];try{f=this._graphs[d].routeArray()}catch(g){console.error("Error getting route array: "+g.message)}if(b.length&&f[0].system.id===a.id)return b.push(this._graphs[d]),b;for(var h=0,i=f.length;i>h;h+=1)f[h].system!==a||c[f[h].system.id]||(c[f[h].system.id]=!0,
b.push(this._graphs[d]))}return b},splitAt:function(a){var b=this.__findGraphs(a);if(b.length>1)return console.error("Can't split at '"+a.name+"', graphs are already split"),!1;if(1!==b.length)return console.error("Couldn't find graph for waypoint '"+a.name+"'"),!1;var c=b[0],d=(c.routeArray(),c.lastNode().system);c.end=a;for(var e=0,f=this._graphs.length;f>e;e+=1)if(this._graphs[e]===c){this._graphs.splice(e+1,0,new SCMAP.Dijkstra(SCMAP.System.List,a,d));for(var g=0;g<this.waypoints.length;g+=1)if(this.waypoints[g]===d){this.waypoints.splice(g,0,a);break}return this.__syncGraphs(),this.storeToSession(),!0}console.error("Couldn't match graph to split")},toString:function(){var a=[];return this.start instanceof SCMAP.System&&a.push(this.start.toString()),$.each(this.waypoints,function(b,c){c instanceof SCMAP.System&&a.push(c)}),a.join(" > ")},removeWaypoint:function(a){var b=this.__findGraphs(a);if(2!==b.length)return console.error("Can't remove waypoint '"+a.name+"', it is not a waypoint"),!1;var c=b[0],d=b[1];c.end=d.start;for(var e=0,f=this._graphs.length;f>e;e+=1)if(this._graphs[e]===d){console.log("Matched "+d+" starting at index "+e),console.log(this._graphs),this._graphs.splice(e,1),console.log(this._graphs);for(var g=0;g<this.waypoints.length;g+=1)if(this.waypoints[g]===a){console.log("Matched "+a+" at index "+g),console.log(this.waypoints),this.waypoints.splice(g,1),console.log(this.waypoints);break}return this.__syncGraphs(),this.storeToSession(),!0}},moveWaypoint:function(a,b){var c;return a===b?!1:b===this.start||this.waypoints.indexOf(b)>=0?!1:a===this.start?1!==this.waypoints.length||b!==this.waypoints[0]?(this.start=b,this.__syncGraphs(),this.storeToSession(),!0):!1:(c=this.waypoints.indexOf(a),c>-1?(this.waypoints[c]=b,this.__syncGraphs(),this.storeToSession(),!0):this.splitAt(a)&&(c=this.waypoints.indexOf(a),c>-1)?(this.waypoints[c]=b,this.__syncGraphs(),this.storeToSession(),!0):!1)},setRoute:function(){var a,b=Array.prototype.slice.call(arguments);if(this.start=b.shift(),this.start=this.start instanceof SCMAP.System?this.start:null,this.waypoints=[],this.start){for(a=0;a<b.length;a+=1)b[a]instanceof SCMAP.System&&this.waypoints.push(b[a]);for(a=0;a<this.waypoints.length;a+=1)this.waypoints[a]=this.waypoints[a]instanceof SCMAP.System?this.waypoints[a]:null}this.storeToSession()},__syncGraphs:function(){var a=[];this._graphs=a,this._error=void 0;try{for(var b=0,c=this.waypoints.length;c>b;b+=1){var d,e=0===b?this.start:this.waypoints[b-1],f=this.waypoints[b];this._graphs[b]instanceof SCMAP.Dijkstra?(d=this._graphs[b],this._graphs[b].start=e,this._graphs[b].end=f):d=new SCMAP.Dijkstra(SCMAP.System.List,e,f),d.buildGraph("time",!0),a.push(d);var g=d.routeArray();if(g.length<=1)throw console.warn("No route from "+e.name+" to "+f.name+" possible"),new RouteSegmentFailed("No route from "+e.name+" to "+f.name+" available")}this._graphs=a,a.length>0&&console.log("Synced and built "+a.length+" graphs")}catch(h){this._error=h,h instanceof RouteSegmentFailed||console.error("Error building route: "+h.message)}},lastError:function(){return this._error},isSet:function(){var a=this.currentRoute();return a.length>1},currentRoute:function(){for(var a=[],b=0,c=this._graphs.length;c>b;b+=1)if(this.waypoints[b]instanceof SCMAP.System){this._graphs[b].rebuildGraph();for(var d=this._graphs[b].routeArray(this.waypoints[b]),e=0;e<d.length;e+=1)a.push(d[e])}return a},alphaOfSystem:function(a){if(!a instanceof SCMAP.System)return 0;var b=0,c=this.currentRoute();if(c.length)for(var d=0,e=c.length;e>d;d++)if(c[d].system===a){b=d;break}return b?b/c.length:0},indexOfCurrentRoute:function(a){if(!(!a instanceof SCMAP.System)){var b,c=this.currentRoute();if(c.length)for(var d=0,e=c.length;e>d;d++)if(c[d].system===a){b=d;break}return b}},rebuildCurrentRoute:function(){this.removeFromScene();for(var a=0,b=this._graphs.length;b>a;a++)if(this._graphs[a].rebuildGraph()){var c=this._graphs[a].destination();c&&(console.log("Have existing destination, updating route"),this.update(c))}},destroy:function(){this.start=null,this.waypoints=[],this.update()},removeFromScene:function(){this._routeObject&&scene.remove(this._routeObject)},buildTemplateData:function(){var a,b,c,d={settings:{avoidHostile:SCMAP.settings.route.avoidHostile,avoidUnknownJumppoints:SCMAP.settings.route.avoidUnknownJumppoints,avoidOffLimits:SCMAP.settings.route.avoidOffLimits}},e=this.currentRoute();if(e.length)for(d.from=e[0].system,d.to=e[e.length-1].system,d.waypoints=[],d.totalDuration=0,b=0,entireRouteLength=e.length;b<entireRouteLength;b+=1)a=e[b].system,b>0&&a.id===e[b-1].system.id?(c=d.waypoints[d.waypoints.length-1],c.iconClass="fa-times text-danger",c.iconTitle="Remove waypoint",c.rowClass="waypoint",c.action='<a href="#" class="remove-waypoint" data-system="'+a.id+'">'):(c={rowClass:"",index:d.waypoints.length+1,system:a,iconClass:"fa-long-arrow-down",iconTitle:"Jump Point",duration:1800,action:""},0===b?(c.duration=900,c.rowClass="start",c.iconClass="fa-flag",c.iconTitle="Start"):b===e.length-1&&(c.duration=900,c.rowClass="end",c.iconClass="fa-flag-checkered",c.iconTitle="Destination"),d.waypoints.push(c),d.totalDuration+=c.duration);else this.start&&this.waypoints.length?d.status={text:"No route available with your current settings.","class":"impossible"}:d.status={text:"No route set","class":"no-route"};return d},update:function(){var a,b,c,d,e=this.toString();this.__syncGraphs(),this.removeFromScene();var f=this.currentRoute();if(f.length){if(this.lastError())return;destination=this.waypoints[this.waypoints.length-1],this._routeObject=new THREE.Object3D,this._routeObject.matrixAutoUpdate=!1;var g=new THREE.Color(15658598),h=new THREE.Color(16724770);for(a=0,c=f.length-1;c>a;a+=1){var i=f[a].system,j=f[a+1].system,k=this.createRouteGeometry(i,j);if(k){b=new THREE.MeshBasicMaterial({color:g.clone().lerp(h,this.alphaOfSystem(j))});var l=new THREE.Mesh(k,b);l.position.copy(i.sceneObject.position),l.lookAt(j.sceneObject.position),this._routeObject.add(l)}}if("object"==typeof this.start.sceneObject){var m=window.map.createSelectorObject(g);for(m.scale.set(3.8,3.8,3.8),m.position.copy(this.start.sceneObject.position),m.visible=!0,this._routeObject.add(m),a=0,d=this.waypoints.length;d>a;a+=1)"object"==typeof this.waypoints[a].sceneObject&&(m=window.map.createSelectorObject(g.clone().lerp(h,this.alphaOfSystem(this.waypoints[a]))),m.scale.set(3.8,3.8,3.8),m.position.copy(this.waypoints[a].sceneObject.position),m.visible=!0,this._routeObject.add(m));scene.add(this._routeObject)}}$(SCMAP.UI.Tab("route").id).empty().append(SCMAP.UI.Templates.routeList({route:this.buildTemplateData()})),this.toString()!==e&&ui.toTab("route")},storeToSession:function(){hasSessionStorage&&(this.start&&this.waypoints.length?window.sessionStorage.currentRoute=JSON.stringify({start:this.start.id,waypoints:$.map(this.waypoints,function(a,b){return a.id})}):delete window.sessionStorage.currentRoute)},restoreFromSession:function(){if(hasSessionStorage&&"currentRoute"in window.sessionStorage){var a=JSON.parse(window.sessionStorage.currentRoute);this.start=SCMAP.System.getById(a.start),this.waypoints=$.map(a.waypoints,function(a,b){return SCMAP.System.getById(a)})}},createRouteGeometry:function(a,b){if(a.sceneObject&&b.sceneObject){var c=a.sceneObject.position.distanceTo(b.sceneObject.position),d=new THREE.CylinderGeometry(.6,.6,c,8,1,!0);return d.applyMatrix((new THREE.Matrix4).makeTranslation(0,c/2,0)),d.applyMatrix((new THREE.Matrix4).makeRotationX(THREE.Math.degToRad(90))),d}}},RouteSegmentFailed.prototype=new Error,RouteSegmentFailed.prototype.constructor=RouteSegmentFailed,SCMAP.Map=function(){this.name="Star Citizen Persistent Universe",this.scene=new THREE.Scene,this.canEdit=!1,this._interactables=[],this._route=null,this._selectorObject=this.createSelectorObject(10092441),this.scene.add(this._selectorObject),this._mouseOverObject=this.createSelectorObject(8930559),this._mouseOverObject.scale.set(4,4,4),this.scene.add(this._mouseOverObject),SCMAP.Faction.preprocessFactions(SCMAP.data.factions),SCMAP.Goods.preprocessGoods(SCMAP.data.goods),this.__currentlySelected=null,this.animate=this._animate.bind(this);var a=this;$.ajax({url:$("#sc-map-configuration").data("systems-json"),async:!0,cache:!0,dataType:"json",ifModified:!0,timeout:5e3}).done(function(b,c,d){var e,f=window.sessionStorage;a.populate(b),a.scene.add(a.buildReferenceGrid()),window.ui.updateSystemsList(),window.renderer.controls.idle(),window.renderer.controls.throttledEventListener.init("change",function(){var b=new THREE.Euler(window.renderer.camera.userData.phi+Math.PI/2,window.renderer.camera.userData.theta,0,"YXZ"),c=(new THREE.Matrix4).makeRotationFromEuler(b);$("#debug-camera-is-moving")&&$("#debug-camera-is-moving").text("Camera is moving"),window.renderer.controls.rememberPosition(),a.scene.traverse(function(a){a instanceof THREE.Sprite&&a.userData.isLabel?a.position.copy(a.userData.position.clone().applyMatrix4(c)):a instanceof THREE.LOD&&a.update(window.renderer.camera)})}),a.route().restoreFromSession(),a.route().update(),hasSessionStorage()&&"selectedSystem"in f&&(e=SCMAP.System.getById(f.selectedSystem),e instanceof SCMAP.System&&(a.setSelectionTo(e),e.displayInfo(!0))),window.ui.updateHeight()}).fail(function(a,b,c){console.error("Ajax request failed:",c,b)}),this.displayState=this.buildDisplayModeFSM(SCMAP.settings.mode)},SCMAP.Map.prototype={constructor:SCMAP.Map,getSelected:function(){return this.__currentlySelected},selected:function(){return this.getSelected()},_animate:function(){var a=300*THREE.Math.degToRad(25e-5*Date.now());this.scene.traverse(function(b){b.userData.isSelector&&(b.rotation.y=a)})},setSelected:function(a){var b=window.sessionStorage;if(null!==a&&!(a instanceof SCMAP.System))throw new Error(a,"is not an instance of SCMAP.System");return this.__currentlySelected=a,hasSessionStorage()&&(b.selectedSystem=a.id),a},createSelectorObject:function(a){var b=new THREE.Mesh(SCMAP.SelectedSystemGeometry,new THREE.MeshBasicMaterial({color:a}));return b.scale.set(4.2,4.2,4.2),b.visible=!1,b.userData.systemPosition=new THREE.Vector3(0,0,0),b.userData.isSelector=!0,b.userData.scaleY=function(a,b){var c=a.userData.systemPosition.y*(b/100);a.translateY(c-a.position.y)},b},__updateSelectorObject:function(a){a instanceof SCMAP.System?(this._selectorObject.visible=!0,this._selectorObject.userData.systemPosition.copy(a.position),this.moveSelectorTo(a),this.setSelected(a)):(this._selectorObject.visible=!1,this.setSelected(null))},route:function(){return this._route instanceof SCMAP.Route||(this._route=new SCMAP.Route,console.log("Created new route",this._route.toString())),this._route},setSelectionTo:function(a){return this.__updateSelectorObject(a)},getSystemByName:function(a){return SCMAP.System.getByName(a)},interactables:function(){return this._interactables},deselect:function(){return this.__updateSelectorObject()},updateSystems:function(){for(var a=0;a<SCMAP.System.List.length;a++)SCMAP.System.List[a].updateSceneObject(this.scene)},setAllLabelSizes:function(a){for(var b=0;b<SCMAP.System.List.length;b++)SCMAP.System.List[b].setLabelScale(a)},moveSelectorTo:function(a){var b,c,d,e,f,g,h=this,j=[];if(!(h._selectorObject.visible&&h.getSelected()instanceof SCMAP.System))return h._selectorObject.userData.systemPosition.copy(a.position),h._selectorObject.position.copy(a.sceneObject.position),h._selectorObject.visible=!0,void h.getSelected(a);if(c=a.sceneObject.position.clone(),f=new SCMAP.Dijkstra(SCMAP.System.List,h.getSelected(),a),f.buildGraph(),g=f.routeArray(a),g.length<=1)return h._selectorObject.userData.systemPosition.copy(a.position),h._selectorObject.position.copy(a.sceneObject.position),h._selectorObject.visible=!0,void h.setSelected(a);for(d={x:h._selectorObject.position.x,y:h._selectorObject.position.y,z:h._selectorObject.position.z},i=0;i<g.length-1;i++)e=g[i+1].system,b=new TWEEN.Tween(d).to({x:e.sceneObject.position.x,y:e.sceneObject.position.y,z:e.sceneObject.position.z},800/(g.length-1)).easing(TWEEN.Easing.Linear.None).onUpdate(function(){h._selectorObject.position.set(this.x,this.y,this.z)}),0==i&&(2==g.length?b.easing(TWEEN.Easing.Cubic.InOut):b.easing(TWEEN.Easing.Cubic.In)),i>0&&j[i-1].chain(b),i==g.length-2&&(b.easing(TWEEN.Easing.Cubic.Out),b.onComplete(function(){h._selectorObject.userData.systemPosition.copy(e.position),h._selectorObject.position.copy(e.sceneObject.position),h.setSelected(a)})),j.push(b);j[0].start()},populate:function(a){var b,c,d,e,f=0,g=this;c=d=new Date,SCMAP.System.preprocessSystems(a),$(SCMAP.System.List).each(function(a,b){var c=b.buildSceneObject();g.scene.add(c),g._interactables.push(c.userData.interactable),f++,b.sceneObject=c}),$(SCMAP.System.List).each(function(a,c){for(e=0;e<c.jumpPoints.length;e++)b=c.jumpPoints[e].buildSceneObject(),b instanceof THREE.Object3D&&(c._routeObjects.push(b),g.scene.add(b))}),c=new Date,console.log("Populating the scene (without ref plane) took "+(c.getTime()-d.getTime())+" msec"),$("#debug-systems").html(f+" systems loaded");var h=this;SCMAP.UI.waitForFontAwesome(function(){h.updateSystems()})},closestPOI:function(a){var b,c,d,e,f,g,h=1/0;for(e in SCMAP.data.systems)c=SCMAP.System.getByName(e),f=a.x-c.position.x,g=a.z-c.position.z,d=Math.sqrt(f*f+g*g),h>d&&(h=d,b=c);return[h,b]},closestFromArray:function(a,b){for(var c,d,e,f,g,h=1/0,i=0;i<b.length;i++)d=b[i],f=a.x-d.position.x,g=a.z-d.position.z,e=Math.sqrt(f*f+g*g),h>e&&(h=e,c=d);return[h,c]},withinApproxDistance:function(a,b){for(var c=[],d=0;d<SCMAP.System.List.length;d+=1){var e=SCMAP.System.List[d];e.position.x<a.x-b||e.position.x>a.x+b||e.position.z<a.z-b||e.position.z>a.z+b||c.push(e)}return c},furthestPOI:function(a){var b,c,d,e,f,g,h=0;for(e in SCMAP.data.systems)c=SCMAP.System.getByName[e],f=a.x-c.position.x,g=a.z-c.position.z,d=Math.sqrt(f*f+g*g),d>h&&(h=d,b=c);return[h,b]},pointAtPlane:function(a,b,c){return new THREE.Vector3(b*Math.cos(a),c,-b*Math.sin(a))},buildReferenceGrid:function(){function a(a,b,c,d){if(G>=65534)throw new Error("Too many points");return F.push(a[0],a[1],a[2]),H.push(b.r,b.g,b.b),G++,F.push(c[0],c[1],c[2]),H.push(d.r,d.g,d.b),I.push(G-1,G),G++}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=10,r=0,s=0,t=0,u=0,v={},w=new THREE.BufferGeometry,x={},y={};for(h=i=new Date,b=0;b<SCMAP.System.List.length;b+=1)g=SCMAP.System.List[b].position,g.x<r&&(r=g.x-60),g.x>t&&(t=g.x+80),g.z<s&&(s=g.z-60),g.z>u&&(u=g.z+100);r=Math.floor(r/q)*q,s=Math.floor(s/q)*q,t=Math.floor(t/q)*q,u=Math.floor(u/q)*q;for(var z=s;u>=z;z+=q){x[z]={};for(var A=r;t>=A;A+=q){y[A]=!0;var B=new THREE.Vector3(A,0,z),C=this.withinApproxDistance(B,6.5*q);p=this.colorForVector(B,C,q),p!==SCMAP.Map.BLACK?(x[z][A]=p.getHexString(),void 0===v[x[z][A]]&&(v[x[z][A]]=p)):(x[z][A]=null,v[null]=SCMAP.Map.BLACK)}}var D=[];for(c in y)D.push(c);D.sort(function(a,b){return a-b}),y=D;var E=[];for(c in x)E.push(c);E.sort(function(a,b){return a-b});var F=[],G=0,H=[],I=[];for(b=1;b<E.length;b+=1){for(f=E[b],n=[],o=[],c=1;c<y.length;c+=1)e=y[c],j=Math.floor(Number(e)-q),k=Math.floor(Number(e)+q),vertexColor=x[f][e],(vertexColor!==x[f][j]&&x[f][j]||vertexColor!==x[f][k]&&x[f][k])&&(n.push([e,0,f]),o.push(v[vertexColor]));for(d=0;d<n.length-1;d++)a(n[d],o[d],n[d+1],o[d+1])}for(b=1;b<y.length;b+=1){for(e=y[b],n=[],o=[],c=1;c<E.length;c+=1)f=E[c],l=Math.floor(Number(f)-q),m=Math.floor(Number(f)+q),vertexColor=x[f][e],(x[l]&&x[l][e]&&vertexColor!==x[l][e]||x[m]&&x[m][e]&&vertexColor!==x[m][e])&&(n.push([e,0,f]),o.push(v[vertexColor]));for(d=0;d<n.length-1;d++)a(n[d],o[d],n[d+1],o[d+1])}var J=new THREE.BufferAttribute;J.array=new Uint16Array(I),J.itemSize=1,w.addAttribute("index",J),J=new THREE.BufferAttribute,J.array=new Float32Array(F),J.itemSize=3,w.addAttribute("position",J),J=new THREE.BufferAttribute,J.array=new Float32Array(H),J.itemSize=3,w.addAttribute("color",J),w.dynamic=!1,w.computeBoundingBox();var K=new THREE.Line(w,new THREE.LineBasicMaterial({linewidth:1.5,wireframe:!0,vertexColors:THREE.VertexColors}),THREE.LinePieces);return K.matrixAutoUpdate=!1,h=new Date,console.log("Building the grid reference plane took "+(h.getTime()-i.getTime())+" msec"),K},colorForVector:function(a,b,c){var d=SCMAP.Map.BLACK,e=this.closestFromArray(a,b);return e[0]<=4.5*c&&e[1]&&(d=e[1].faction.planeColor.clone(),e[0]>=4*c?d.multiplyScalar(.5):e[0]>=3*c&&d.multiplyScalar(.8)),d},buildDisplayModeFSM:function(a){var b,c,d,e,f=this;return d={y:"3d"===a?100:.5},b=new TWEEN.Tween(d).to({y:.5},1e3).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){f.route().removeFromScene();for(var a=0;a<f.scene.children.length;a++){var b=f.scene.children[a];"function"==typeof b.userData.scaleY&&b.userData.scaleY(b,this.y)}}),c=new TWEEN.Tween(d).to({y:100},1e3).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){f.route().removeFromScene();for(var a=0;a<f.scene.children.length;a++){var b=f.scene.children[a];"function"==typeof b.userData.scaleY&&b.userData.scaleY(b,this.y)}}),e=StateMachine.create({initial:a||"3d",events:[{name:"to2d",from:"3d",to:"2d"},{name:"to3d",from:"2d",to:"3d"}],callbacks:{onenter2d:function(){$("#sc-map-3d-mode").prop("checked",!1),storage&&(storage.mode="2d")},onenter3d:function(){$("#sc-map-3d-mode").prop("checked",!0),storage&&(storage.mode="3d")},onleave2d:function(){return c.onComplete(function(){e.transition(),f.route().update()}),c.start(),StateMachine.ASYNC},onleave3d:function(){return b.onComplete(function(){e.transition(),f.route().update()}),b.start(),StateMachine.ASYNC}},error:function(a,b,c,d,e,f){console.log("event "+a+" was naughty : "+f)}})}},SCMAP.Map.BLACK=new THREE.Color(0),SCMAP.UI=function(a){var b=this,c=null;hasSessionStorage()&&"selectedSystem"in window.sessionStorage&&(c=SCMAP.System.getById(window.sessionStorage.selectedSystem),c instanceof SCMAP.System?a.setSelectionTo(c):c=null),this.map=a;var d=[];for(var e in SCMAP.Symbols)e=SCMAP.Symbols[e],d.push($('<span><i class="fa-li fa '+e.faClass+'"></i>'+e.description+"</span>").css("color",e.color).outerHtml());$("#sc-map-interface").empty().append(SCMAP.UI.Templates.mapUI({instructions:["Left-click and release to select a system.","Left-click and drag from system to system to map a route between them.","Left-click and drag any waypoint on the route to move it. It moves an existing waypoint or creates new waypoints as needed.","Left-click and drag on the map to rotate the camera around the center of the map.","Mousewheel to zoom in and out, middle-click and drag can also be used.","Right-click to pan the camera around the map."],shortcuts:[{key:"R",description:"Reset camera orientation"},{key:"C",description:"Camera to center (Sol)"},{key:"T",description:"Top-down camera"},{key:"L",description:"Lock/unlock camera rotation"},{key:"2",description:"Switch to 2D mode"},{key:"3",description:"Switch to 3D mode"},{key:"Esc",description:"Deselect target"}],icons:d,systemGroups:SCMAP.UI.buildDynamicLists(),system:c,settings:{glow:SCMAP.settings.glow,labels:SCMAP.settings.labels,labelIcons:SCMAP.settings.labelIcons,effect:{Antialias:SCMAP.settings.effect.Antialias,FXAA:SCMAP.settings.effect.FXAA,Bloom:SCMAP.settings.effect.Bloom}},route:a.route().buildTemplateData()})),$(SCMAP.UI.menuBar).each(function(a,b){$("#sc-map-interface ul.menubar").append(b)}),$("#sc-map-3d-mode").prop("checked","3d"===SCMAP.settings.mode).on("change",function(){this.checked?b.map.displayState.to3d():b.map.displayState.to2d()}),$("#sc-map-lock-rotation").prop("checked",SCMAP.settings.control.rotationLocked).on("change",function(){renderer.controls.noRotate=this.checked,storage&&(storage["control.rotationLocked"]=this.checked?"1":"0")}),$("#sc-map-resetCamera").on("click",function(){renderer.controls.cameraTo(SCMAP.settings.cameraDefaults.target,SCMAP.settings.cameraDefaults.orientation.theta,SCMAP.settings.cameraDefaults.orientation.phi,SCMAP.settings.cameraDefaults.orientation.radius)}),$("#sc-map-centreCamera").on("click",function(){renderer.controls.moveTo(SCMAP.settings.cameraDefaults.target)}),$("#sc-map-northCamera").on("click",function(){renderer.controls.rotateTo(0,void 0,void 0)}),$("#sc-map-topCamera").on("click",function(){renderer.controls.rotateTo(0,0,180)}),$("#sc-map-top2D").on("click",function(){renderer.controls.noRotate=!0,$("#sc-map-lock-rotation").prop("checked",!0),b.map.displayState.to2d(),renderer.controls.rotateTo(0,0,180)});var f=0;if(hasSessionStorage()&&"scMapTab"in window.sessionStorage){var g=SCMAP.UI.Tab(window.sessionStorage.scMapTab);g&&(f=g.index)}$("#sc-map-interface").tabs({active:f,activate:function(a,c){a.preventDefault();var d=c.newTab.find("a").data("tab");SCMAP.UI.Tab(d);switch(d){case"systems":b.updateSystemsList();break;default:$("#sc-map-webgl-container").removeClass("edit")}hasSessionStorage()&&(window.sessionStorage.scMapTab=d),$("#sc-map-interface a[href='#']").removeAttr("href"),b.updateHeight(),b.toTabTop()}}),$("#sc-map-toggle-glow").prop("checked",SCMAP.settings.glow),$("#sc-map-toggle-labels").prop("checked",SCMAP.settings.labels),$("#sc-map-toggle-label-icons").prop("checked",SCMAP.settings.labelIcons),$("#sc-map-interface").on("change",".sc-map-avoid-hostile",function(){SCMAP.settings.route.avoidHostile=this.checked,SCMAP.settings.save("route"),a.route().update(),a.route().storeToSession()}),$("#sc-map-interface").on("change",".sc-map-avoid-unknown-jumppoints",function(){SCMAP.settings.route.avoidUnknownJumppoints=this.checked,SCMAP.settings.save("route"),a.route().update(),a.route().storeToSession()}),$("#sc-map-interface").on("change",".sc-map-avoid-off-limits",function(){SCMAP.settings.route.avoidOffLimits=this.checked,SCMAP.settings.save("route"),a.route().update(),a.route().storeToSession()}),hasSessionStorage()&&(window.sessionStorage.uiWidth=SCMAP.UI.widthClasses[SCMAP.UI.widthClassToIndex(window.sessionStorage.uiWidth)],$("#sc-map-interface").removeClass(SCMAP.UI.widthClasses.join(" ")).addClass(window.sessionStorage.uiWidth)),$("#sc-map-interface .sc-map-slider-uiwidth").slider({min:0,max:SCMAP.UI.widthClasses.length-1,range:"min",value:hasSessionStorage()?SCMAP.UI.widthClassToIndex(window.sessionStorage.uiWidth):SCMAP.UI.defaultWidthIndex,change:function(a,c){var d=c.value;$("#sc-map-interface").removeClass(SCMAP.UI.widthClasses.join(" ")).addClass(SCMAP.UI.widthClasses[d]),hasSessionStorage()&&(window.sessionStorage.uiWidth=SCMAP.UI.widthClasses[d]),b.updateHeight(),renderer.resize()}});var h=function(b,c){var d=c.value;SCMAP.settings.labelScale=d/100,SCMAP.settings.storage&&(SCMAP.settings.storage["settings.labelScale"]=SCMAP.settings.labelScale),a.scene.traverse(function(a){a instanceof THREE.Sprite&&a.userData.systemLabel&&a.userData.systemLabel.scaleSprite()})};$("#sc-map-interface .sc-map-slider-label-size").slider({min:100*(Number($("#sc-map-configuration").data("minLabelScale"))||.4),max:100*(Number($("#sc-map-configuration").data("maxLabelScale"))||2),value:100*SCMAP.settings.labelScale,change:h,slide:h});var i=function(b,c){var d=c.value;SCMAP.settings.labelOffset=d/100,SCMAP.settings.storage&&(SCMAP.settings.storage["settings.labelOffset"]=SCMAP.settings.labelOffset);var e=window.renderer.cameraRotationMatrix();a.scene.traverse(function(a){a instanceof THREE.Sprite&&a.userData.systemLabel&&a.userData.systemLabel.positionSprite(e)})};$("#sc-map-interface .sc-map-slider-label-offset").slider({min:100*(Number($("#sc-map-configuration").data("minLabelOffset"))||-6.5),max:100*(Number($("#sc-map-configuration").data("maxLabelOffset"))||7.5),value:100*SCMAP.settings.labelOffset,change:i,slide:i});var j=function(b,c){var d=c.value;SCMAP.settings.systemScale=d/100,SCMAP.settings.storage&&(SCMAP.settings.storage["settings.systemScale"]=SCMAP.settings.systemScale);var e;window.renderer.cameraRotationMatrix();a.scene.traverse(function(a){a.userData.scale&&a.userData.isSystem?(e=SCMAP.settings.systemScale,a.scale.set(e,e,e),a.updateMatrix()):a.userData.scale&&a.userData.isGlow&&(e=a.userData.scale*SCMAP.System.GLOW_SCALE*SCMAP.settings.systemScale,a.scale.set(e,e,e))})};$("#sc-map-interface .sc-map-slider-system-size").slider({min:100*(Number($("#sc-map-configuration").data("minSystemScale"))||.5),max:100*(Number($("#sc-map-configuration").data("maxSystemScale"))||2),value:100*SCMAP.settings.systemScale,change:j,slide:j}),$("#sc-map-toggle-stats").prop("checked",storage&&"1"===storage["renderer.Stats"]?!0:!1).on("change",function(){this.checked?$("#stats").show():$("#stats").hide(),storage&&(storage["renderer.Stats"]=this.checked?"1":"0")}),$("#sc-map-toggle-antialias").on("change",function(){SCMAP.settings.effect.Antialias=this.checked,SCMAP.settings.save("effect"),window.location.reload(!1)}),$("#sc-map-toggle-fxaa").prop("disabled",SCMAP.settings.effect.Antialias).on("change",function(){SCMAP.settings.effect.FXAA=this.checked,SCMAP.settings.save("effect"),renderer.FXAA&&(renderer.FXAA.enabled=this.checked)}),$("#sc-map-toggle-bloom").prop("disabled",SCMAP.settings.effect.Antialias).on("change",function(){if(SCMAP.settings.effect.Bloom=this.checked,SCMAP.settings.save("effect"),renderer.composer)for(var a=0;a<renderer.composer.passes.length;a++)renderer.composer.passes[a]instanceof THREE.BloomPass&&(renderer.composer.passes[a].enabled=this.checked)}),$("#sc-map-toggle-glow").on("change",function(){SCMAP.settings.glow=this.checked,a.updateSystems(),storage&&(storage["settings.Glow"]=this.checked?"1":"0")}),$("#sc-map-toggle-labels").on("change",function(){SCMAP.settings.labels=this.checked,$("#sc-map-toggle-label-icons").prop("disabled",!SCMAP.settings.labels),a.updateSystems(),storage&&(storage["settings.Labels"]=this.checked?"1":"0")}),$("#sc-map-toggle-label-icons").prop("disabled",!SCMAP.settings.labels).on("change",function(){SCMAP.settings.labelIcons=this.checked,a.updateSystems(),storage&&(storage["settings.LabelIcons"]=this.checked?"1":"0")}),$(".quick-button.with-checkbox").on("click",function(a){var b=$(this);b.find("input[type=checkbox]").click()}),$("#sc-map-interface").on("click","a[data-toggle-next]",function(a){var b=$(this);a.preventDefault();var c=b.parent().next();c.toggle();var d=b.data("title"),e=null;hasSessionStorage()&&(e=window.sessionStorage),c.is(":visible")?(b.parent().find("> a > i").first().removeClass("fa-caret-right").addClass("fa-caret-down"),e&&(e[d]="1")):(b.parent().find("> a > i").first().addClass("fa-caret-right").removeClass("fa-caret-down"),e&&delete e[d]),ui.updateHeight()}),$("#sc-map-interface").on("click","a[data-toggle-child]",function(a){var b=$(this);a.preventDefault();var c=b.parent().find(b.data("toggle-child"));c.toggle(),c.is(":visible")?b.parent().find("> a > i").removeClass("fa-caret-right").addClass("fa-caret-down"):b.parent().find("> a > i").addClass("fa-caret-right").removeClass("fa-caret-down"),ui.updateHeight()}),$("#sc-map-interface").on("click","a[data-goto='system']",function(a){a.preventDefault();var b=$(this),c=SCMAP.System.getById(b.data("system"));c.displayInfo(),renderer.controls.moveTo(c)}),$("#sc-map-interface").on("click","table.routelist .remove-waypoint",function(b){b.preventDefault();var c=$(this),d=SCMAP.System.getById(c.data("system"));a.route().removeWaypoint(d),a.route().update(),a.route().storeToSession()}),$("#sc-map-interface").on("click","button.delete-route",function(b){a.route().destroy(),a.route().storeToSession()});var k=function(a){a.preventDefault();var b=SCMAP.System.getById($(this).data("system")),c=$(this).val();"string"==typeof c&&c.length>0?(b.setComments(c),$("#sc-map-interface .user-system-comments-md").html($(markdown.toHTML(c)))):(b.setComments(),$("#sc-map-interface .user-system-comments-md").empty()),b.updateSceneObject(scene)};$("#sc-map-interface").on("keyup",".user-system-comments",k),$("#sc-map-interface").on("blur",".user-system-comments",k),$("#sc-map-interface").on("change",".user-system-comments",k),$("#sc-map-interface").on("click",".remove-system-comments",function(a){a.preventDefault();var b=SCMAP.System.getById($(this).data("system"));b.setComments(),$(".comment-editing .user-system-comments").empty().val(""),$(".comment-editing .user-system-comments-md").empty(),b.updateSceneObject(scene)}),$("#sc-map-interface").on("change",".user-system-bookmarked",function(){SCMAP.System.getById($(this).data("system")).setBookmarkedState(this.checked).updateSceneObject(scene),SCMAP.settings.save("systems")}),$("#sc-map-interface").on("change",".user-system-ishangar",function(){SCMAP.System.getById($(this).data("system")).setHangarState(this.checked).updateSceneObject(scene),SCMAP.settings.save("systems")}),$("#sc-map-interface").on("change",".user-system-avoid",function(){SCMAP.System.getById($(this).data("system")).setToBeAvoidedState(this.checked).updateSceneObject(scene),SCMAP.settings.save("systems"),a.route().rebuildCurrentRoute()}),$("#sc-map-interface").jScrollPane({showArrows:!1,horizontalGutter:6})},SCMAP.UI.prototype={constructor:SCMAP.UI,toTab:function(a){var b=SCMAP.UI.Tab(a);$("#sc-map-interface").tabs("option","active",b.index),this.updateHeight()},toTabTop:function(){this.jScrollPane()&&this.jScrollPane().scrollToPercentY(0)},updateHeight:function(){var a=this,b=SCMAP.UI.ActiveTab();if(b){var c=$(b.id+" img");c.length?$(b.id).imagesLoaded(function(){a.jScrollPane()&&a.jScrollPane().reinitialise()}):a.jScrollPane()&&a.jScrollPane().reinitialise()}},jScrollPane:function(){return $("#sc-map-interface").data("jsp")?$("#sc-map-interface").data("jsp"):void 0},updateSystemsList:function(){var a=SCMAP.UI.Tab("systems");$(a.id).empty().append(SCMAP.UI.Templates.listings({systemGroups:SCMAP.UI.buildDynamicLists()}))}},SCMAP.UI.menuBar=[],SCMAP.UI.widthClasses=["widthXS","widthS","widthN","widthL","widthXL"],SCMAP.UI.defaultWidthIndex=2,SCMAP.UI.widthClassToIndex=function(a){if("string"==typeof a)for(var b=0;b<SCMAP.UI.widthClasses.length;b+=1)if(a===SCMAP.UI.widthClasses[b])return b;return SCMAP.UI.defaultWidthIndex},SCMAP.UI.Tabs=[],SCMAP.UI.Tab=function(a){for(var b=0;b<SCMAP.UI.Tabs.length;b+=1){if("string"==typeof a&&SCMAP.UI.Tabs[b].name===a)return SCMAP.UI.Tabs[b];if("number"==typeof a&&SCMAP.UI.Tabs[b].id===a)return SCMAP.UI.Tabs[b]}},SCMAP.UI.ActiveTab=function(){for(var a=$("#sc-map-interface").tabs("option","active"),b=0;b<SCMAP.UI.Tabs.length;b+=1)if(b===a)return SCMAP.UI.Tabs[b]},SCMAP.UI.makeSafeForCSS=function(a){return"string"==typeof a?a.replace(/[^a-zA-Z0-9]/g,function(a){var b=a.charCodeAt(0);return 32==b?"-":b>=65&&90>=b?"_"+a.toLowerCase():b.toString(16).slice(-4)}):void 0},SCMAP.UI.fontAwesomeIsReady=!1,SCMAP.UI.waitForFontAwesome=function(a){var b=5,c=function(){var d,e;b-=1,d=document.createElement("canvas"),d.width=20,d.height=20,e=d.getContext("2d"),e.fillStyle="rgba(0,0,0,1.0)",e.fillRect(0,0,20,20),e.font="16pt FontAwesome",e.textAlign="center",e.fillStyle="rgba(255,255,255,1.0)",e.fillText("",10,18);var f=e.getImageData(2,10,1,1).data;255!==f[0]&&255!==f[1]&&255!==f[2]?(console.log("FontAwesome is not yet available, retrying ..."),b>0&&setTimeout(c,200)):(console.log("FontAwesome is loaded"),SCMAP.UI.fontAwesomeIsReady=!0,"function"==typeof a&&a())};c()},SCMAP.UI.buildDynamicLists=function(){var a=[],b=[],c=[],d=[],e={},f=[];for(var g in SCMAP.data.factions){var h=SCMAP.data.factions[g];e[h.id]={faction:h.name,items:[]}}return $(SCMAP.System.List).each(function(f,g){var h=g.createInfoLink().outerHtml();g.hasHangar()&&a.push(h),g.isBookmarked()&&b.push(h),g.hasComments()&&c.push(h),e[g.faction.id].items.push(h),d.push(h)}),a.length&&f.push({title:"Hangar locations&nbsp;"+SCMAP.Symbol.getTag(SCMAP.Symbols.HANGAR).addClass("fa-lg").outerHtml(),items:a}),b.length&&f.push({title:"Bookmarked&nbsp;"+SCMAP.Symbol.getTag(SCMAP.Symbols.BOOKMARK).addClass("fa-lg").outerHtml(),items:b}),c.length&&f.push({title:"With your comments&nbsp;"+SCMAP.Symbol.getTag(SCMAP.Symbols.COMMENTS).addClass("fa-lg").outerHtml(),items:c}),f.push({title:"By faction",factions:e},{title:"Everything",items:d}),f},SCMAP.UI.htmlEscape=function(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
},SCMAP.UI.Templates={mapUI:Handlebars.compile($("#templateMapUI").html()),systemInfo:Handlebars.compile($("#templateSystemInfo").html()),listings:Handlebars.compile($("#templateSystemsListing").html()),routeList:Handlebars.compile($("#templateRouteList").html())},$(function(){var a=1,b=0;Handlebars.registerHelper("uiSection",function(b,c,d){var e,f=c?!0:!1,g="fa-caret-right",h='style="display: none;"',i=[],j=a++,k=null;hasSessionStorage()&&(k=window.sessionStorage),k&&b in k&&(f="1"==k[b]?!0:!1),f&&(g="fa-caret-down",h="");for(var l in d.hash)i.push(l+'="'+d.hash[l]+'"');return e="<h"+j+'><a href="#" data-title="'+SCMAP.UI.htmlEscape(b)+'" data-toggle-next="next" '+i.join(" ")+'><i class="fa fa-fw fa-lg '+g+'"></i>'+b+"</a></h"+j+'>\n         <div class="ui-section" '+h+">","fn"in d&&(e+=d.fn(this)),e+="</div>",a-=1,new Handlebars.SafeString(e)}),Handlebars.registerHelper("tabHeader",function(a){return new Handlebars.SafeString('<h1 class="padleft">'+a+"</h1>")}),Handlebars.registerHelper("jQueryUiTab",function(a,c,d,e){var f,g="",h="sc-map-ui-tab-"+SCMAP.UI.makeSafeForCSS(c);return f=$('<li><a title="'+SCMAP.UI.htmlEscape(a)+'" data-tab="'+SCMAP.UI.htmlEscape(c)+'" href="#'+SCMAP.UI.htmlEscape(h)+'"><i class="fa fa-fw fa-2x '+SCMAP.UI.htmlEscape(d)+'"></i></a></li>'),SCMAP.UI.menuBar.push(f),g='<div id="'+h+'" class="sc-map-ui-tab" '+(0!==b?'style="display: none"':"")+">","fn"in e&&(g+=e.fn(this)),g+="</div>",SCMAP.UI.Tabs.push({id:"#"+h,name:c,index:b++}),new Handlebars.SafeString(g)}),Handlebars.registerHelper("bigButton",function(a,b,c){return new Handlebars.SafeString('<button class="big-button" id="'+a+'"><i class="fa '+b+' fa-fw fa-lg"></i> '+c+"</button><br>")}),Handlebars.registerHelper("commoditiesList",function(a){return a.length?new Handlebars.SafeString($.map(a,function(a,b){return SCMAP.data.goods[a].name}).join(", ")):new Handlebars.SafeString("&mdash;")}),Handlebars.registerHelper("markdown",function(a){return new Handlebars.SafeString(markdown.toHTML(a))}),Handlebars.registerHelper("colourGetStyle",function(a){return new Handlebars.SafeString(a.getStyle())}),Handlebars.registerHelper("systemLink",function(a,b){var c=!1,d=!1;return"noIcons"in b.hash&&(c=b.hash.noIcons?!0:!1),"noTarget"in b.hash&&(d=b.hash.noTarget?!0:!1),a instanceof SCMAP.System?new Handlebars.SafeString(a.createInfoLink(c,d).outerHtml()):""}),Handlebars.registerHelper("routeNavLinks",function(a,b,c){var d,e="";return a||b?(a instanceof SCMAP.System?(d=$("<a></a>"),a.faction instanceof SCMAP.Faction&&a.faction.color instanceof THREE.Color&&d.css("color",a.faction.color.getStyle()),d.addClass("system-link"),d.attr("data-goto","system"),d.attr("data-system",a.id),d.attr("href","#system="+encodeURIComponent(a.name)),d.attr("title","Previous jump, coming from "+a.name+" ("+a.faction.name+" territory)"),d.empty().append('<i class="left fa fa-fw fa-arrow-left"></i>'),e+=d.outerHtml()):e+='<i class="left fa fa-fw"></i>',b instanceof SCMAP.System?(d=$("<a></a>"),b.faction instanceof SCMAP.Faction&&b.faction.color instanceof THREE.Color&&d.css("color",b.faction.color.getStyle()),d.addClass("system-link"),d.attr("data-goto","system"),d.attr("data-system",b.id),d.attr("href","#system="+encodeURIComponent(b.name)),d.attr("title","Next jump, leading to "+b.name+" ("+b.faction.name+" territory)"),d.empty().append('<i class="right fa fa-fw fa-arrow-right"></i>'),e+=d.outerHtml()):e+='<i class="right fa fa-fw"></i>',new Handlebars.SafeString(e)):new Handlebars.SafeString("")}),Handlebars.registerHelper("checkboxButton",function(a,b,c){var d=[];for(var e in c.hash)"icon"===e?b=b+' <i class="fa fa-lg fa-fw '+c.hash[e]+'"></i>':d.push(e+'="'+SCMAP.UI.htmlEscape(c.hash[e])+'"');return new Handlebars.SafeString('<span class="checkmark-button"><input type="checkbox" id="'+a+'" '+d.join(" ")+'><label for="'+a+'">'+b+"</label></span>")}),Handlebars.registerHelper("debug",function(a){console.log("Current Context",this),a&&console.log("Value",a)}),Handlebars.registerHelper("durationHMM",function(a){return a?new Handlebars.SafeString(a.toHMM()):""}),Handlebars.registerHelper("plusOne",function(a){return new Handlebars.SafeString(a+1)}),Handlebars.registerHelper("minusOne",function(a){return new Handlebars.SafeString(a-1)}),Handlebars.registerHelper("checked",function(a){return new Handlebars.SafeString(a?"checked":"")}),Handlebars.registerHelper("checkboxOption",function(a,b,c,d,e){var f=[],g="";b&&(g="checked");for(var h in e.hash)"icon"===h?c=c+' <i class="fa fa-lg fa-fw '+e.hash[h]+'"></i>':f.push(h+'="'+SCMAP.UI.htmlEscape(e.hash[h])+'"');return new Handlebars.SafeString('<span class="checkmark-option"><input class="'+a+'" type="checkbox" id="'+a+'" '+g+'><label for="'+a+'">'+c+'<span class="small label-info">'+d+"</span></label></span>")}),$('script[type="text/x-handlebars-template"][data-partial="1"]').each(function(a,b){var c=$(b);Handlebars.registerPartial(c.attr("id"),c.html())})}),function(){function a(a){var b=a.__resizeTriggers__,c=b.firstElementChild,d=b.lastElementChild,e=c.firstElementChild;d.scrollLeft=d.scrollWidth,d.scrollTop=d.scrollHeight,e.style.width=c.offsetWidth+1+"px",e.style.height=c.offsetHeight+1+"px",c.scrollLeft=c.scrollWidth,c.scrollTop=c.scrollHeight}function b(a){return a.offsetWidth!=a.__resizeLast__.width||a.offsetHeight!=a.__resizeLast__.height}function c(c){var d=this;a(this),this.__resizeRAF__&&f(this.__resizeRAF__),this.__resizeRAF__=e(function(){b(d)&&(d.__resizeLast__.width=d.offsetWidth,d.__resizeLast__.height=d.offsetHeight,d.__resizeListeners__.forEach(function(a){a.call(d,c)}))})}var d=document.attachEvent;if(!d)var e=function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};return function(b){return a(b)}}(),f=function(){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.clearTimeout;return function(b){return a(b)}}();window.addResizeListener=function(b,e){d?b.attachEvent("onresize",e):(b.__resizeTriggers__||("static"==getComputedStyle(b).position&&(b.style.position="relative"),b.__resizeLast__={},b.__resizeListeners__=[],(b.__resizeTriggers__=document.createElement("div")).className="resize-triggers",b.__resizeTriggers__.innerHTML='<div class="expand-trigger"><div></div></div><div class="contract-trigger"></div>',b.appendChild(b.__resizeTriggers__),a(b),b.addEventListener("scroll",c,!0)),b.__resizeListeners__.push(e))},window.removeResizeListener=function(a,b){d?a.detachEvent("onresize",b):(a.__resizeListeners__.splice(a.__resizeListeners__.indexOf(b),1),a.__resizeListeners__.length||(a.removeEventListener("scroll",c),a.__resizeTriggers__=!a.removeChild(a.__resizeTriggers__)))}}(),SCMAP.Renderer=function(a){this.map=a,this.composer=null,this.FXAA=null,this.camera=null,this.textureManager=new SCMAP.TextureManager,this.width=window.innerWidth,this.height=window.innerHeight,this.resize=this._resize.bind(this),this.animate=this._animate.bind(this),this.render=this._render.bind(this),this.dpr=1,void 0!==window.devicePixelRatio&&(this.dpr=window.devicePixelRatio);var b=$("#sc-map-webgl-container")[0];this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,10,1600),this.camera.position.copy(SCMAP.settings.camera.camera),this.camera.setViewOffset(this.width,this.height,-($("#sc-map-interface .sc-map-ui-padding").width()/2),0,this.width,this.height),this.controls=new SCMAP.OrbitControls(this,b),this.controls.target.copy(SCMAP.settings.camera.target),this.controls.rotateSpeed=$("#sc-map-configuration").data("rotateSpeed"),this.controls.zoomSpeed=$("#sc-map-configuration").data("zoomSpeed"),this.controls.panSpeed=$("#sc-map-configuration").data("panSpeed"),this.controls.noRotate=SCMAP.settings.control.rotationLocked,this.threeRenderer=new THREE.WebGLRenderer({antialias:!0}),SCMAP.settings.effect.Antialias||(this.threeRenderer.autoClear=!1),this.threeRenderer.setClearColor(0,1),this.threeRenderer.setSize(this.width,this.height),b.appendChild(this.threeRenderer.domElement);if(this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.stats.domElement.style.right="0px",this.stats.domElement.style.display="none",this.stats.domElement.style.zIndex="100",b.appendChild(this.stats.domElement),SCMAP.settings.renderer.Stats&&$("#stats").show(),hasLocalStorage()&&(storage=window.localStorage),window.addEventListener("resize",this.resize,!1),document.addEventListener("change",this.render,!1),!SCMAP.settings.effect.Antialias){var c=new THREE.RenderPass(this.map.scene,this.camera);this.FXAA=new THREE.ShaderPass(THREE.FXAAShader),this.FXAA.uniforms.resolution.value.set(1/(this.width*this.dpr),1/(this.height*this.dpr)),this.FXAA.enabled=SCMAP.settings.effect.FXAA;var d=new THREE.BloomPass(.6);d.enabled=SCMAP.settings.effect.Bloom;var e=new THREE.ShaderPass(THREE.CopyShader);e.renderToScreen=!0,this.composer=new THREE.EffectComposer(this.threeRenderer),this.composer.setSize(this.width*this.dpr,this.height*this.dpr),this.composer.addPass(c),this.composer.addPass(this.FXAA),this.composer.addPass(d),this.composer.addPass(e)}this.animate()},SCMAP.Renderer.prototype={constructor:SCMAP.Renderer,cameraRotationMatrix:function(){var a=new THREE.Euler(this.camera.userData.phi+Math.PI/2,this.camera.userData.theta,0,"YXZ");return(new THREE.Matrix4).makeRotationFromEuler(a)},_resize:function(){this.width=window.innerWidth,this.height=window.innerHeight,this.camera.aspect=this.width/this.height,this.camera.setViewOffset(this.width,this.height,-($("#sc-map-interface .sc-map-ui-padding").width()/2),0,this.width,this.height),this.camera.updateProjectionMatrix(),this.FXAA&&this.FXAA.uniforms.resolution.value.set(1/(this.width*this.dpr),1/(this.height*this.dpr)),this.threeRenderer.setSize(this.width,this.height),this.composer&&this.composer.reset(),window.ui.updateHeight()},_animate:function(){requestAnimationFrame(this.animate),TWEEN.update(),this.controls.update(),this.map.animate(),this.stats.update(),this.render()},_render:function(){this.composer?(this.threeRenderer.clear(),this.composer.render()):this.threeRenderer.render(this.map.scene,this.camera)}},SCMAP.OrbitControls=function(a,b){function c(){return 2*Math.PI/60/60*m.autoRotateSpeed}function d(){return Math.pow(.95,m.zoomSpeed)}function e(a){m.enabled!==!1&&(a.preventDefault(),R.starttouch(a),document.addEventListener("mousemove",f,!1),document.addEventListener("mouseup",g,!1),m.dispatchEvent(P))}function f(a){if(m.enabled!==!1){a.preventDefault();var b,c,d=m.domElement===document?m.domElement.body:m.domElement;if(m.cameraIsMoving()||a.clientX!==y.x&&a.clientY!==y.y&&(b=m.getIntersect(a),b&&b.object.parent.userData.system&&b.object.parent.userData.system!==H?(H=b.object.parent.userData.system,window.map._mouseOverObject.position.copy(H.sceneObject.position),window.map._mouseOverObject.visible=!0):b&&b.object.parent.userData.system||(void 0!==H&&(window.map._mouseOverObject.position.set(0,0,0),window.map._mouseOverObject.visible=!1),H=void 0)),y.set(a.clientX,a.clientY),"touch"===R.current)0===a.button?R.touchtorotate(a):1===a.button?R.touchtodolly(a):2===a.button&&R.touchtopan(a);else if("drag"===R.current)F&&b&&b.object.parent.userData.system&&b.object.parent.userData.system!==F&&(G&&G===b.object.parent.userData.system?G=void 0:(G=b.object.parent.userData.system,c=window.map.route(),c.isSet()?(c.moveWaypoint(F,G),F!==G&&c.update(),F=G,console.log('In-route mode -- intermediate object while dragging is "'+G.name+'"')):(c.start=F,c.waypoints=[G],c.update(),c.storeToSession(),m.debug&&console.log('Intermediate object while dragging is "'+G.name+'"'))));else if("rotate"===R.current){if(m.noRotate===!0)return;p.set(a.clientX,a.clientY),q.subVectors(p,o),m.rotateLeft(2*Math.PI*q.x/d.clientWidth*m.rotateSpeed),m.rotateUp(2*Math.PI*q.y/d.clientHeight*m.rotateSpeed),o.copy(p)}else if("dolly"===R.current){if(m.noZoom===!0)return;w.set(a.clientX,a.clientY),x.subVectors(w,v),x.y>0?m.dollyIn():m.dollyOut(),v.copy(w)}else if("pan"===R.current){if(m.noPan===!0)return;s.set(a.clientX,a.clientY),t.subVectors(s,r),m.pan(t.x,t.y),r.copy(s)}m.update()}}function g(a){m.enabled!==!1&&(document.removeEventListener("mousemove",f,!1),document.removeEventListener("mouseup",g,!1),m.dispatchEvent(Q),R.idle(a))}function h(a){if(m.enabled!==!1&&m.noZoom!==!0){a.preventDefault(),a.stopPropagation();var b=0;a.deltaY?b=a.deltaY:a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail),b>0?m.dollyOut():0>b&&m.dollyIn(),m.update(),m.dispatchEvent(P),m.dispatchEvent(Q)}}function i(a){if(m.enabled!==!1&&m.noKeys!==!0&&m.noPan!==!0&&a.altKey!==!0&&a.shiftKey!==!0&&a.ctrlKey!==!0&&a.metaKey!==!0){var b=$(document.activeElement);if("comments"===b.attr("id"))return void((a.keyCode==m.keys.ESCAPE||a.keyCode==m.keys.TAB)&&b.blur());var c=!1;switch(a.keyCode){case m.keys.UP:a.preventDefault(),m.pan(0,m.keyPanSpeed),c=!0;break;case m.keys.BOTTOM:a.preventDefault(),m.pan(0,-m.keyPanSpeed),c=!0;break;case m.keys.LEFT:a.preventDefault(),m.pan(m.keyPanSpeed,0),c=!0;break;case m.keys.RIGHT:a.preventDefault(),m.pan(-m.keyPanSpeed,0),c=!0;break;case m.keys.ESCAPE:window.map.deselect();break;case m.keys.TAB:break;case m.keys.R:m.rotateTo(0,void 0,void 0);break;case m.keys.C:m.moveTo(SCMAP.settings.cameraDefaults.target);break;case m.keys.T:m.rotateTo(0,0,200);break;case m.keys[2]:m.noRotate=!0,$("#sc-map-lock-rotation").prop("checked",!0),m.map.displayState.to2d(),m.rotateTo(0,0,180);break;case m.keys[3]:m.map.displayState.to3d(),m.rotateTo(SCMAP.settings.cameraDefaults.orientation.theta,SCMAP.settings.cameraDefaults.orientation.phi,SCMAP.settings.cameraDefaults.orientation.radius);break;case m.keys.L:$("#sc-map-lock-rotation").click()}c&&(m.dispatchEvent(P),m.dispatchEvent(Q),S=!0,m.update())}}function j(a){m.enabled!==!1&&m.dispatchEvent(P)}function k(a){m.enabled!==!1&&(a.preventDefault(),a.stopPropagation())}function l(a){m.enabled!==!1&&(m.dispatchEvent(Q),R.idle(a))}this.object=a.camera,this.domElement=void 0!==b?b:document,this.map=a.map,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=20,this.maxDistance=800,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=40,this.mapMode=!0,this.minPolarAngle=0,this.maxPolarAngle=THREE.Math.degToRad(85),this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,ESCAPE:27,R:82,C:67,T:84,2:50,3:51,L:76,SPACE:32,TAB:9};var m=this,n=1e-6,o=new THREE.Vector2,p=new THREE.Vector2,q=new THREE.Vector2,r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector3,v=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,y=new THREE.Vector2,z=0,A=0,B=1,C=new THREE.Vector3,D=new THREE.Vector3,E=new THREE.Quaternion;this.debug=!1;var F,G,H;this.target0=this.target.clone(),this.position0=this.object.position.clone();var I,J,K,L,M,N=(new THREE.Quaternion).setFromUnitVectors(this.object.up,new THREE.Vector3(0,1,0)),O=(N.clone().inverse(),{type:"change"}),P={type:"start"},Q={type:"end"},R=StateMachine.create({initial:{state:"loading",event:"init",defer:!0},events:[{name:"startup",from:"loading",to:"idle"},{name:"starttouch",from:"idle",to:"touch"},{name:"touchtodrag",from:"touch",to:"drag"},{name:"touchtorotate",from:"touch",to:"rotate"},{name:"touchtodolly",from:"touch",to:"dolly"},{name:"touchtopan",from:"touch",to:"pan"},{name:"startdolly",from:"idle",to:"dolly"},{name:"startpan",from:"idle",to:"pan"},{name:"idle",from:["*"],to:"idle"}],callbacks:{onenterstate:function(a,b,c){m.showState(c)},onentertouch:function(a,b,c,d){if(m.enabled!==!1){d.preventDefault(),m.debug&&console.log(a,": entered state",c,"from",b);var e;if(0===d.button){if(e=m.getIntersect(d),e&&e.object.parent.userData.system)F=e.object.parent.userData.system,m.debug&&console.log('Click at "'+e.object.parent.userData.system.name+'"'),window.map.setSelectionTo(F),F.displayInfo("doNotSwitch"),this.touchtodrag(d);else if(!m.noRotate){if(m.noRotate===!0)return;o.set(d.clientX,d.clientY),this.touchtorotate(d)}}else if(1===d.button){if(m.noZoom===!0)return;v.set(d.clientX,d.clientY),this.touchtodolly(d)}if(2===d.button||m.noRotate&&!e){if(m.noPan===!0)return;r.set(d.clientX,d.clientY),this.touchtopan(d)}}},onenterdrag:function(a,b,c,d){m.enabled!==!1&&m.debug&&console.log(a,": entered state",c,"from",b)},onenteridle:function(a,b,c,d){if(m.debug&&console.log(a,": idling after",b),"drag"===b){var e=m.getIntersect(d);if(e&&e.object.parent.userData.system)if(G=e.object.parent.userData.system,m.debug&&console.log('Ended dragging at "'+G.toString()+'"'),G===F)G.displayInfo();else{window.map.selected()===G;var f=window.map.route();f.isSet()&&F!==G&&(f.update(G),f.storeToSession(),ui.toTab("route"))}}F=void 0,G=void 0,m.debug&&console.log("idling ...")}},error:function(a,b,c,d,e,f){m.debug&&console.log("event "+a+" was naughty : "+f)}}),S=!1;this.stateMachine=function(){return R},this.showState=function(a){window.jQuery&&window.jQuery("#debug-state")&&window.jQuery("#debug-state").text("State: "+a)},this.rotateLeft=function(a){void 0===a&&(a=c()),A-=a},this.rotateUp=function(a){void 0===a&&(a=c()),z-=a},this.panLeft=function(a){var b=this.object.matrix.elements;u.set(b[0],b[1],b[2]),u.multiplyScalar(-a),C.add(u)},this.panUp=function(a){if(this.mapMode)return this.panBack(a);var b=new THREE.Vector3,c=this.object.matrix.elements;b.set(c[4],c[5],c[6]),b.multiplyScalar(a),C.add(b)},this.panBack=function(a){var b=this.target.clone().setY(this.object.position.y),c=this.object.position.clone().sub(b).negate().setLength(a);C.add(c)},this.moveTo=function(a){var b,c=this,d=this.target.clone();if(a instanceof SCMAP.System)b=a.position.clone().setY(this.target.y);else{if(!(a instanceof THREE.Vector3))return;b=a.clone().setY(this.target.y)}a instanceof SCMAP.System&&window.map.setSelectionTo(a),I&&I.stop(),I=new TWEEN.Tween(d).to({x:b.x,y:b.y,z:b.z},750).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){var a=new THREE.Vector3(this.x,this.y,this.z);c.goTo(a),S=!0}),I.onComplete(function(){I=void 0}),I.start()},this.rememberPosition=function(){SCMAP.settings.camera.camera=this.object.position,SCMAP.settings.camera.target=this.target,SCMAP.settings.save("camera")},this.rotateTo=function(a,b,c){var d=this.objectVectorToTarget(),e=Math.atan2(d.x,d.z),f=Math.atan2(Math.sqrt(d.x*d.x+d.z*d.z),d.y),g={left:e,up:f,radius:d.length()};rotateLeft=g.left,rotateUp=g.up,J&&J.stop(),J=new TWEEN.Tween(g).to({left:a,up:b,radius:c},1e3).easing(TWEEN.Easing.Cubic.InOut).onUpdate(function(){K=this.left,L=this.up,M=this.radius,S=!0,m.dispatchEvent(O)}),J.onComplete(function(){J=void 0,K=void 0,L=void 0,M=void 0,m.dispatchEvent(Q)}),m.dispatchEvent(P),J.start()},this.cameraTo=function(a,b,c,d){this.rotateTo(b,c,d),this.moveTo(a)},this.goTo=function(a){a=a.clone().setY(this.target.y),a.sub(this.target),C.add(a)},this.pan=function(a,b){var c=m.domElement===document?m.domElement.body:m.domElement;if(void 0!==m.object.fov){var d=m.object.position,e=d.clone().sub(m.target),f=e.length();f*=Math.tan(m.object.fov/2*Math.PI/180),m.panLeft(2*a*f/c.clientHeight),m.panUp(2*b*f/c.clientHeight)}else void 0!==m.object.top?(m.panLeft(a*(m.object.right-m.object.left)/c.clientWidth),m.panUp(b*(m.object.top-m.object.bottom)/c.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(a){void 0===a&&(a=d()),B/=a,S=!0},this.dollyOut=function(a){void 0===a&&(a=d()),B*=a,S=!0},this.getIntersect=function(a){if(window.map.interactables()){var b,c,d,e;return b=new THREE.Vector3(a.clientX/window.innerWidth*2-1,2*-(a.clientY/window.innerHeight)+1,.5),c=new THREE.Projector,c.unprojectVector(b,m.object),d=new THREE.Raycaster(m.object.position,b.sub(m.object.position).normalize()),e=d.intersectObjects(window.map.interactables()),e[0]}},this.objectVectorToTarget=function(){return this.object.position.clone().sub(this.target)},this.currentState=function(){return R.current},this.cameraIsMoving=function(){return"pan"===R.current||"dolly"===R.current||"rotate"===R.current||"loading"===R.current||!v.equals(w)||S},this.throttledEventListener=function(){function a(){e||(e=!0,window.requestAnimationFrame?window.requestAnimationFrame(b):setTimeout(b,66))}function b(){for(var a in d)d.hasOwnProperty(a)&&d[a].forEach(function(a){a()});e=!1}function c(a,b){a&&b&&(a in d||(d[a]=[]),d[a].push(b))}var d={},e=!1;return{init:function(b,d){window.renderer.controls.addEventListener(b,a),c(b,d)},add:function(a,b){c(a,b)}}}(),this.update=function(){if("idle"!==R.current||0!==C.length()||S){S=!0;var a=this.objectVectorToTarget();this.target.add(C);var b=Math.atan2(a.x,a.z),c=Math.atan2(Math.sqrt(a.x*a.x+a.z*a.z),a.y);b+=A,c+=z,void 0!==K&&(b=K),void 0!==L&&(c=L),c=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,c)),c=Math.max(n,Math.min(Math.PI-n,c)),this.object.userData.phi=c,this.object.userData.theta=b;var d=a.length()*B;void 0!==M&&(d=M),$("#debug-angle").html("Camera heading: "+THREE.Math.radToDeg(b).toFixed(1)+"&deg; ("+b.toFixed(2)+")<br>Camera tilt: "+THREE.Math.radToDeg(c).toFixed(1)+"&deg; ("+c.toFixed(2)+")<br>Camera distance: "+d.toFixed(1)),d=Math.max(this.minDistance,Math.min(this.maxDistance,d)),a.x=d*Math.sin(c)*Math.sin(b),a.y=d*Math.cos(c),a.z=d*Math.sin(c)*Math.cos(b),this.object.position.copy(this.target).add(a),this.object.lookAt(this.target),A=0,z=0,B=1,C.set(0,0,0),(D.distanceToSquared(this.object.position)>n||8*(1-E.dot(this.object.quaternion))>n)&&(this.dispatchEvent(O),D.copy(this.object.position),E.copy(this.object.quaternion)),S=!1}},this.idle=function(){R.idle()},R.init(),this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",e,!1),this.domElement.addEventListener("mousewheel",h,!1),this.domElement.addEventListener("DOMMouseScroll",h,!1),this.domElement.addEventListener("touchstart",j,!1),this.domElement.addEventListener("touchend",l,!1),this.domElement.addEventListener("touchmove",k,!1),window.addEventListener("keydown",i,!1),this.domElement.addEventListener("mousemove",f,!1),this.update()},SCMAP.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),SCMAP.SystemLabel=function(a){this.system=a,this.node=null,this.fontFamily="'Segoe UI', 'Lucida Grande', 'Tahoma', 'Calibri', 'Roboto', sans-serif",this.textsize=58,this.textVerticalOffset=8.5,this.symbolVerticalOffset=-22.5,this.paddingX=6,this.paddingY=36.5,this.symbolSize=24,this.symbolSpacing=2,this.outline=2.4,this._width=null,this._height=null,this.scale=1.2,this.system.isUnknown()&&(this.scale=.8),this.scale*=1.48},SCMAP.SystemLabel.prototype={constructor:SCMAP.SystemLabel,clear:function(){this.node&&this.node.clear()},uvCoordinates:function(){return this.node?this.node.uvCoordinates():null},getNode:function(a){if(this.node)return this.node;var b=a.canvas.getContext("2d");return this.node=a.insert({width:Math.floor(this.width(b))-1,height:Math.floor(this.height(b))-1}),this.node},drawText:function(){if(!this.node)return!1;var a=this.node.clipContext();return a.scale(this.scale,this.scale),a.font="Bold "+this.textsize+"px "+this.fontFamily,a.textAlign="center",a.textBaseline="middle",a.fillStyle=this.system.factionStyle(),a.lineCap="round",a.lineJoin="round",a.lineWidth=this.outline,a.miterLimit=2,a.fillText(this.system.name,0,this.textVerticalOffset),a.strokeStyle="rgb(0,0,0)",a.strokeText(this.system.name,0,this.textVerticalOffset),this.node.restoreContext(),!0},drawSymbols:function(){var a,b,c,d,e=this.system.getSymbols(),f=-(this.symbolsWidth(e)/2);if(!this.node)return!1;var g=this.node.clipContext();for(g.scale(this.scale,this.scale),a=0;a<e.length;a++)b=e[a],c=0,d=0,b.offset&&(c=b.offset.x,d=b.offset.y),g.font=(this.symbolSize*b.scale).toFixed(2)+"px FontAwesome",g.strokeStyle="rgba(0,0,0,1.0)",g.textAlign="center",g.lineWidth=4,g.strokeText(b.code,f+c+this.symbolSize/2,this.symbolVerticalOffset+d),g.fillStyle=b.color,g.fillText(b.code,f+c+this.symbolSize/2,this.symbolVerticalOffset+d),f+=this.symbolSize+this.symbolSpacing;this.node.restoreContext()},update:function(a){var b=this.node.knapsack;return this.node&&(this.node.release(),this.node=null),this._width=null,this._height=null,this.node=window.renderer.textureManager.allocateTextureNode(this.width(),this.height()),this.node?(this.drawText(),a&&this.drawSymbols(),this.node.knapsack!==b&&(this.sceneObject.material=new THREE.SpriteMaterial({map:this.node.texture})),this.node.setUV(),this.sceneObject.material.texture=this.node.texture,this.sceneObject.material.map.needsUpdate=!0,this.scaleSprite(),!0):null},scaleSprite:function(){var a=SCMAP.settings.labelScale*SCMAP.System.LABEL_SCALE;this.sceneObject.scale.set(a*(this.node.rectangle.width()/this.node.rectangle.height()),a,1),this.system.isUnknown()&&(this.sceneObject.scale.x*=SCMAP.System.UNKNOWN_SYSTEM_SCALE,this.sceneObject.scale.y*=SCMAP.System.UNKNOWN_SYSTEM_SCALE)},positionSprite:function(a){this.sceneObject.userData.position=new THREE.Vector3(0,-SCMAP.settings.labelOffset,-.1);var b=this.sceneObject.userData.position.clone();b.applyMatrix4(a),this.sceneObject.position.copy(b)},symbolsWidth:function(a){return this.symbolSize*a.length+this.symbolSpacing*(a.length-1)},width:function(a){var b,c,d;return this._width?this._width:(a||(d=document.createElement("canvas"),d.width=256,d.height=100,a=d.getContext("2d")),a.font="Bold "+this.textsize+"px "+this.fontFamily,a.textBaseline="bottom",a.lineWidth=this.outline,b=a.measureText(this.system.name).width+this.paddingX,c=this.symbolsWidth(this.system.getSymbols()),c>b&&(b=c+4*this.paddingX),this._width=Math.floor(b*this.scale),this._width)},height:function(){return this._height?this._height:(this._height=Math.floor((this.textsize+this.paddingY)*this.scale),this._height)}},SCMAP.Knapsack=function(a){this.canvas=a,this.rootNode=new SCMAP.Knapsack.Node(this),this.rootNode.rectangle=new SCMAP.Knapsack.Rectangle(0,0,a.width-1,a.height-1)},SCMAP.Knapsack.prototype={constructor:SCMAP.Knapsack,insert:function(a){var b=this.rootNode.insert(a);return null!==b&&b.claim(),b}},SCMAP.Knapsack.Rectangle=function(a,b,c,d){this.left="number"==typeof a?Math.floor(a):0,this.top="number"==typeof b?Math.floor(b):0,this.right="number"==typeof c?Math.floor(c):0,this.bottom="number"==typeof d?Math.floor(d):0},SCMAP.Knapsack.Rectangle.prototype={constructor:SCMAP.Knapsack.Node,Xcentre:function(){return Math.floor((this.right-this.left)/2+this.left)-.5},Ycentre:function(){return Math.floor((this.bottom-this.top)/2+this.top)-.5},width:function(){return this.right-this.left},height:function(){return this.bottom-this.top}},SCMAP.Knapsack.Node=function(a){this.knapsack=a,this.canvas=a.canvas,this.leftChild=null,this.rightChild=null,this.rectangle=null,this.imageID=null,this.texture=null,this.generateUUID=function(){return THREE.Math.generateUUID()}},SCMAP.Knapsack.Node.prototype={constructor:SCMAP.Knapsack.Node,claim:function(a){this.imageID=this.generateUUID()},release:function(){if(this.leftChild||this.rightChild)throw new Error("Can't release tree nodes");this.imageID=null,this.clear()},clear:function(){var a=this.canvas.getContext("2d");a.clearRect(this.rectangle.left,this.rectangle.top,this.rectangle.width()-1,this.rectangle.height()-1)},clipContext:function(){var a=this.canvas.getContext("2d");return a.save(),a.beginPath(),a.rect(this.rectangle.left+1,this.rectangle.top+1,this.rectangle.width()-2,this.rectangle.height()-2),a.clip(),a.translate(this.rectangle.Xcentre(),this.rectangle.Ycentre()),a},restoreContext:function(){var a=this.canvas.getContext("2d");a.restore()},setUV:function(){var a=this.uvCoordinates();this.texture.offset.x=a[0],this.texture.offset.y=a[1],this.texture.repeat.x=a[2]-a[0],this.texture.repeat.y=a[3]-a[1]},uvCoordinates:function(){return[this.rectangle.left/this.canvas.width,1-this.rectangle.bottom/this.canvas.height,this.rectangle.right/this.canvas.width,1-this.rectangle.top/this.canvas.height]},insert:function(a){if(this.leftChild||this.rightChild){var b=this.leftChild.insert(a);return b instanceof SCMAP.Knapsack.Node?b:this.rightChild.insert(a)}if(this.imageID)return null;if(a.width>this.rectangle.width()||a.height>this.rectangle.height())return null;if(a.width===this.rectangle.width()&&a.height===this.rectangle.height())return this;this.leftChild=new SCMAP.Knapsack.Node(this),this.rightChild=new SCMAP.Knapsack.Node(this);var c=this.rectangle.width()-a.width,d=this.rectangle.height()-a.height;return c>d?(this.leftChild.rectangle=new SCMAP.Knapsack.Rectangle(this.rectangle.left,this.rectangle.top,this.rectangle.left+a.width,this.rectangle.bottom),this.rightChild.rectangle=new SCMAP.Knapsack.Rectangle(this.rectangle.left+a.width,this.rectangle.top,this.rectangle.right,this.rectangle.bottom)):(this.leftChild.rectangle=new SCMAP.Knapsack.Rectangle(this.rectangle.left,this.rectangle.top,this.rectangle.right,this.rectangle.top+a.height),this.rightChild.rectangle=new SCMAP.Knapsack.Rectangle(this.rectangle.left,this.rectangle.top+a.height,this.rectangle.right,this.rectangle.bottom)),this.leftChild.insert(a)}},SCMAP.TextureManager=function(){var a=document.createElement("canvas");a.width=512,a.height=a.width,console.log("SCMAP.TextureManager: Allocated "+a.width+"px texture map #1"),this.knapsacks=[new SCMAP.Knapsack(a)],this.textures=[new THREE.Texture(a,THREE.UVMapping)]},SCMAP.TextureManager.prototype={constructor:SCMAP.TextureManager,allocateTextureNode:function(a,b){var c,d,e,f,g;for(g=0;g<this.knapsacks.length;g++)if(c=this.knapsacks[g],d=c.insert({width:a,height:b}))return d.texture=this.textures[g].clone(),d.texture.needsUpdate=!0,d.setUV(),d;return a<c.canvas.width&&(f=document.createElement("canvas"),f.width=this.knapsacks[0].canvas.width,f.height=this.knapsacks[0].canvas.height,c=new SCMAP.Knapsack(f),e=new THREE.Texture(f,THREE.UVMapping),this.knapsacks.push(c),this.textures.push(e),console.log("SCMAP.TextureManager: Allocated "+f.width+"px texture map #"+this.knapsacks.length),d=c.insert({width:a,height:b}))?(d.texture=e.clone(),d.texture.needsUpdate=!0,d.setUV(),d):null},freeTextureNode:function(a){a&&a.imageID&&a.release()},getCanvases:function(){for(var a=[],b=0;b<this.knapsacks.length;b+=1)a.push(this.knapsacks[b].canvas);return a}};var scene,map,ui,storage,renderer;$(function(){if(Detector.webgl||Detector.addGetWebGLMessage(),hasLocalStorage()&&(storage=window.localStorage),map=new SCMAP.Map,renderer=new SCMAP.Renderer(map),ui=new SCMAP.UI(map),scene=map.scene,/webkit/i.test(navigator.userAgent)){var a=document.getElementById("sc-map-interface");a.addEventListener("scroll",function(a){var b=$("#sc-map-interface").width();$("#sc-map-interface").css("width",b+.1)},!1)}}),Object.values=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},jQuery.fn.outerHtml=function(){return jQuery("<div />").append(this.eq(0).clone()).html()},String.prototype.toHMM=function(){var a=parseInt(this,10),b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60);10>c&&(c="0"+c);var d=b+":"+c;return d},Number.prototype.toHMM=function(){var a=parseInt(this,10),b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60);10>c&&(c="0"+c);var d=b+":"+c;return d};